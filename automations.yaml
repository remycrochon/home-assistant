- id: '1610184966825'
  alias: Calcul Boolean Nuit/Jour
  description: ''
  triggers:
  - value_template: '{{ states(''sensor.bh1750_illuminance'' )|float(default=0) >
      states(''input_number.luminosite_seuil_haut'')|float(default=0) and is_state("sun.sun",
      "above_horizon") }}'
    id: nuit->jour
    trigger: template
  - value_template: '{{ states(''sensor.bh1750_illuminance'')|float(default=0) < states(''input_number.luminosite_seuil_bas'')|float(default=0)
      and is_state("sun.sun", "below_horizon") }}'
    id: jour->nuit
    trigger: template
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: nuit->jour
      sequence:
      - target:
          entity_id: input_boolean.nuit_jour
        data: {}
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: jour->nuit
      sequence:
      - target:
          entity_id: input_boolean.nuit_jour
        data: {}
        action: input_boolean.turn_off
    default: []
  mode: single
- id: '1610371647929'
  alias: 04 Purge base de données
  description: ''
  triggers:
  - at: 00:05:00
    trigger: time
  conditions: []
  actions:
  - data:
      keep_days: 10
      repack: true
    action: recorder.purge
  mode: single
- id: '1617185147880'
  alias: Surveillance et Alarme Appoint d'eau
  description: Ferme la vanne d'eau si ouverte depuis 1 heure
  triggers:
  - entity_id:
    - switch.esp178_cde_ev_eau
    from: 'off'
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      message: '{{states("sensor.date_time") }}{{-"\n"-}}EV eau ouverte depuis plus
        de 1 heure'
      title: Alarme EV Appoint d'eau Piscine
    action: notify.telegram
  - target:
      entity_id:
      - switch.esp178_cde_ev_eau
    action: switch.turn_off
    data: {}
  - action: select.select_option
    metadata: {}
    data:
      option: At_f
    target:
      entity_id: select.esp178_mode_fonct_appoint_eau
  mode: single
- id: '1617199790692'
  alias: Notification alarme niveau bas
  description: ' '
  triggers:
  - entity_id:
    - binary_sensor.esp178_niv_bas
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 10
    trigger: state
  conditions: []
  actions:
  - data:
      title: ALARME
      message: Niveau bas Piscine
    action: notify.telegram
  - action: select.select_option
    data:
      option: At_f
    target:
      entity_id: select.esp178_mode_fonctionnement_filtration
  - data:
      message: Niveau bas piscine{{-"\n"-}}{{states("sensor.date_time") }}{{-"\n"-}}{{states("sensor.date_time")
        }}
      title: Piscine Alarme Niveau Bas !!!
    action: notify.telegram
  mode: single
- id: '1629296468909'
  alias: Robot AMX435 Surveillance Pluviometrie
  description: ''
  triggers:
  - entity_id: sensor.vp2_pluviometrie_moyenne
    above: input_number.seuil_pluie_stop_robot
    id: seuil_haut
    trigger: numeric_state
  - entity_id:
    - sensor.vp2_pluviometrie_moyenne
    id: seuil_bas
    below: input_number.seuil_pluie_stop_robot
    trigger: numeric_state
    for:
      hours: 1
      minutes: 0
      seconds: 0
  - trigger: state
    entity_id:
    - binary_sensor.vp2_trigger_intensite_pluvieuse
    from: 'off'
    to: 'on'
    id: intensité
    enabled: false
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - seuil_haut
        - intensité
      sequence:
      - data: {}
        action: lawn_mower.dock
        target:
          device_id: 7808727539e5cd0a67cbd0484d1835d4
      - data:
          message: Le robot tondeuse a été garé à cause de la forte pluie:{{-"\n"-}}
            Pluvio Moyenne 10mn ({{states('sensor.vp2_pluviometrie_moyenne')}} mm)
            {{-"\n"-}} > Seuil Stop robot ({{states('input_number.seuil_pluie_stop_robot')}}
            mm) {{-"\n"-}} ou Intensité pluvieuse ({{states('sensor.vp2_rain_rate')}}
            mm/h) > 3 mm/h pendant 5mn. {{-"\n"-}} {{states("sensor.date_time") }}
          title: Robot-Début Alerte Meteo Pluie !!!
        action: notify.telegram
    - conditions:
      - condition: trigger
        id: seuil_bas
      sequence:
      - data: {}
        action: lawn_mower.start_mowing
        target:
          device_id: 80c6c60b578848a2d4bb2a1e06f07fb1
        enabled: true
      - data:
          message: Reprise programme horaire!!{{-"\n"-}} Pluvio Moyenne 10mn ( {{states('sensor.vp2_pluviometrie_moyenne')}}
            mm) {{-"\n"-}} < Seuil Stop robot ({{states('input_number.seuil_pluie_stop_robot')}}
            mm) pendant 1h. {{-"\n"-}}{{states("sensor.date_time") }}
          title: Robot- Fin Alerte Meteo Pluie !!!
        action: notify.telegram
  mode: single
  trace:
    stored_traces: 10
- id: '1632232387237'
  alias: 05 Reseau Notification Nouvelle IP
  description: ''
  triggers:
  - entity_id:
    - sensor.myip
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - data:
      message: 'Nouvelle IP: {{ states("sensor.myip")}} {{-"\n"-}}{{states("sensor.date_time")
        }}'
      title: Réseau:!!!
    action: notify.telegram
  - data:
      message: Nouvelle IP {{ states("sensor.myip")}}
      title: Reseau
    action: notify.telegram
  mode: single
- id: '1634569261594'
  alias: Blueprint Notification Alarme Status PAC
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.alarme_status_pac
      alert_state: 'off'
      alert_action:
      - data:
          message: PAC Off Line{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat Reseau !!!
        action: notify.telegram
      - data:
          message: PAC Off Line {{-"\n"-}}{{states("sensor.date_time") }}
        action: notify.telegram
      resolved_action:
      - data:
          message: PAC On Line{{-"\n"-}} {{states("sensor.date_time") }}
          title: Etat RESEAU!!!
        action: notify.telegram
      - data:
          message: PAC On Line{{-"\n"-}}{{states("sensor.date_time") }}
        action: notify.telegram
      notify_message: ' '
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 600
      resolved_message: ' '
      initial_delay: 300
      max_alerts: 10
      condition_entity: input_boolean.inhib_alarme_pac
- id: '1634569580188'
  alias: Blueprint Notification Porte Cellier Ouverte
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.alarme_porte_cellier
      alert_state: 'on'
      alert_action:
      - data:
          message: Porte Cellier ouverte après le coucher du soleil{{-"\n"-}}{{states("sensor.date_time")
            }}
          title: Etat Portes !!!
        action: notify.telegram
      - data:
          message: Porte Cellier ouverte après le coucher du soleil{{-"\n"-}}{{states("sensor.date_time")
            }}
        action: notify.telegram
      resolved_action:
      - data:
          message: Porte Cellier OK{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat Portes!!!
        action: notify.telegram
      - data:
          message: Porte Cellier OK{{-"\n"-}}{{states("sensor.date_time") }}
        action: notify.telegram
      notify_message: ' '
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 600
      resolved_message: ' '
      max_alerts: 5
      initial_delay: 300
- id: '1634569751638'
  alias: Blueprints Notification Porte Sous Sol Ouverte
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      sensor_entity: binary_sensor.alarme_porte_sous_sol
      alert_state: 'on'
      alert_action:
      - data:
          message: Porte Sous Sol ouverte après le coucher du soleil{{-"\n"-}}{{states("sensor.date_time")
            }}
          title: Etat Portes !!!
        action: notify.telegram
      resolved_action:
      - data:
          message: Porte Sous Sol OK{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat Portes!!!
        action: notify.telegram
      notify_message: Porte Sous _Sol Ouverte
      notify_device: 367dba31447009458e03b70e3a29b6b2
      resolved_message: Porte Sous Sol Ok
      initial_delay: 300
      condition_entity_state: 'off'
      max_alerts: 5
      repeat_delay: 600
- id: '1634569897913'
  alias: Blueprint Notification Porte Garage Ouverte
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.alarme_porte_garage
      alert_state: 'on'
      alert_action:
      - data:
          message: Porte Garage ouverte après le coucher du soleil{{-"\n"-}}{{states("sensor.date_time")
            }}
        action: notify.telegram
      resolved_action:
      - data:
          message: Porte Garage OK{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat Portes!!!
        action: notify.telegram
      notify_message: Porte Garage ouverte après le coucher du soleil
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 600
      resolved_message: ' Porte Garage OK'
      initial_delay: 300
      max_alerts: 5
- id: '1634570304569'
  alias: Blueprint Notification Discordance PAC
  description: ' Surveillance discordance PAC entre l''état du thermostat et l''état
    du switch de commande '
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.alarme_discord_pac
      alert_state: 'off'
      alert_action:
      - data:
          message: Discordance PAC=> PU= {{states("sensor.ecocompteur_pac")}} et Pilotage=
            {{states("switch.altherma")}}{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat PAC !!!
        action: notify.telegram
      - data:
          message: Discordance PAC=> PU= {{states("sensor.ecocompteur_pac")}} et Pilotage=
            {{states("switch.altherma")}}{{-"\n"-}}{{states("sensor.date_time") }}
        action: notify.telegram
      resolved_action:
      - data:
          message: PAC OK=> PU= {{states("sensor.ecocompteur_pac")}} et Pilotage=
            {{states("switch.altherma")}}{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat PAC !!!
        action: notify.telegram
      - data:
          message: PAC OK=> PU= {{states("sensor.ecocompteur_pac")}} et Pilotage=
            {{states("switch.altherma")}}{{-"\n"-}}{{states("sensor.date_time") }}
        action: notify.telegram
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 1200
      max_alerts: 10
      initial_delay: 1200
      dismiss_entity: input_boolean.inhib_alarme_pac
      resolved_message: ' '
      notify_message: ' '
- id: '1634571065075'
  alias: Blueprint  Notification Porte frigo garage ouverte
  description: '# Alarme porte frigo garage ouverte   '
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.detecteur_porte_frigo_ouverture
      alert_state: 'on'
      alert_action:
      - data:
          message: Porte Frigo Garage Ouverte {{-"\n"-}}{{states("sensor.date_time")
            }}
        action: notify.telegram
      resolved_action:
      - data:
          message: Porte Frigo Garage Fermée {{-"\n"-}}{{states("sensor.date_time")
            }}
        action: notify.telegram
      notify_message: ' '
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 60
      resolved_message: ' '
      initial_delay: 60
      max_alerts: 5
- id: '1634571983587'
  alias: Blueprint Notification Temp congelo haute
  description: '# Surveillance de la temperature du congelateur  '
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.alarme_temp_congelo_haute
      alert_state: 'on'
      alert_action:
      - data:
          message: T° Haute Congelo = {{states("sensor.temp_congelo_garage") }}°C
            {{-"\n"-}}{{states("sensor.date_time") }}
        action: notify.telegram
      resolved_action:
      - data:
          message: T° Congelo normale = {{states("sensor.temp_congelo_garage") }}°C
            {{-"\n"-}}{{states("sensor.date_time") }}
        action: notify.telegram
      notify_message: ' '
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 300
      resolved_message: ' '
      initial_delay: 300
      max_alerts: 10
- id: '1634621594490'
  alias: Blueprint Notification Def Com VP2
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.status_communication_vantage_pro_2
      alert_state: 'Off'
      alert_action:
      - data:
          message: VP2 Off Line{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat Reseau !!!
        action: notify.telegram
      resolved_action:
      - data:
          message: VP2 On Line{{-"\n"-}} {{states("sensor.date_time") }}
          title: Etat RESEAU!!!
        action: notify.telegram
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 300
      initial_delay: 60
      max_alerts: 5
      resolved_message: ' '
      notify_message: ' '
- id: '1634916685737'
  alias: 03 Pusch gitub
  description: pousse vers githtub
  triggers:
  - at: 02:00
    trigger: time
  conditions: []
  actions:
  - data: {}
    action: shell_command.push_to_github
    response_variable: reponse_push
  - if:
    - condition: template
      value_template: '{{ reponse_push[''returncode''] == 0 }}'
    then:
    - action: notify.telegram
      data:
        title: Push Github OK
        message: '{{ reponse_push[''stdout''] }}'
    else:
    - action: notify.telegram
      data:
        title: Push Github en erreur
        message: '{{ reponse_push[''stderr''] }}'
  mode: single
- id: '1637073026237'
  alias: Balise ouverture Porte sous sol
  description: ''
  triggers:
  - tag_id: 297289a4-380e-4137-bbdc-b21e165e76cc
    trigger: tag
  conditions: []
  actions:
  - target:
      entity_id:
      - cover.porte_sous_sol
    data: {}
    action: cover.open_cover
  mode: single
- id: '1637074521273'
  alias: Balise ouverture porte garage
  description: ''
  triggers:
  - tag_id: dca56861-8baf-4881-a5c8-4b99d90c3716
    trigger: tag
  conditions: []
  actions:
  - target:
      entity_id:
      - cover.porte_garage
    data: {}
    action: cover.open_cover
  mode: single
- id: '1638119466260'
  alias: BluePrint Notification Def Com Linky
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.status_communication_linky
      alert_state: 'off'
      alert_action:
      - data:
          message: Com Linky off Line{{-"\n"-}}{{states("sensor.date_time") }}
          title: Etat Reseau !!!
        action: notify.telegram
      resolved_action:
      - data:
          message: Com Linky On Line{{-"\n"-}} {{states("sensor.date_time") }}
          title: Etat RESEAU!!!
        action: notify.telegram
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 300
      initial_delay: 60
      max_alerts: 5
      resolved_message: ' '
      notify_message: ' '
- id: '1638433932226'
  alias: 01-02-01 VMC Niv0 Automatismes
  description: ' '
  triggers:
  - entity_id: input_select.vmc_niv0
    id: mode
    trigger: state
  - at: input_datetime.heure_vmc_niv0_ma
    trigger: time
  - at: input_datetime.heure_vmc_niv0_at
    trigger: time
  - event: sunrise
    offset: 0
    id: levee_soleil
    trigger: sun
  - value_template: '{% set temp=states(''sensor.vp2_temp_out'') | float(0) %}

      {% set saison=states(''sensor.season'') | default("") %}

      {% set mode=states(''input_select.vmc_niv0'') | default("") %}

      {% set soleil=states(''sun.sun'') | default("") %}

      {{ (temp< 0) and (saison == "autumn" or saison=="winter") and (mode=="CO2 PM2.5")
      and (soleil == ''below_horizon'')}}

      '
    id: temp_basse
    trigger: template
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.vmc_niv0
        state: Hor
      sequence:
      - choose:
        - conditions:
          - condition: time
            after: input_datetime.heure_vmc_niv0_ma
            before: input_datetime.heure_vmc_niv0_at
          sequence:
          - target:
              entity_id:
              - switch.relais_cde_vmc_niv0_on_off
            data: {}
            action: switch.turn_on
        default:
        - target:
            entity_id:
            - switch.relais_cde_vmc_niv0_on_off
          data: {}
          action: switch.turn_off
    - conditions:
      - condition: state
        entity_id: input_select.vmc_niv0
        state: Arret
      sequence:
      - target:
          entity_id:
          - switch.relais_cde_vmc_niv0_on_off
        data: {}
        action: switch.turn_off
    - conditions:
      - condition: state
        entity_id: input_select.vmc_niv0
        state: Marche
      sequence:
      - target:
          entity_id:
          - switch.relais_cde_vmc_niv0_on_off
        data: {}
        action: switch.turn_on
    - conditions:
      - condition: trigger
        id:
        - temp_basse
      sequence:
      - data: {}
        target:
          entity_id:
          - switch.relais_cde_vmc_niv0_on_off
        action: switch.turn_off
    - conditions:
      - condition: trigger
        id:
        - levee_soleil
      - condition: state
        entity_id: input_select.vmc_niv0
        state: CO2 PM2.5
      sequence:
      - data: {}
        target:
          entity_id: switch.relais_cde_vmc_niv0_on_off
        action: switch.turn_on
    default: []
  mode: single
  trace:
    stored_traces: 10
- id: '1642614758763'
  alias: Changement HP<->HC
  description: ''
  triggers:
  - entity_id:
    - sensor.linky_n_tarif
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: sensor.linky_n_tarif
          state: '1'
        - condition: state
          entity_id: sensor.linky_n_tarif
          state: '3'
        - condition: state
          entity_id: sensor.linky_n_tarif
          state: '5'
      sequence:
      - data:
          option: hc
        target:
          entity_id:
          - select.compteur_energie_pac
          - select.compteur_energie_autres_jour
          - select.compteur_energie_onduleur_jour
          - select.compteur_energie_vmc_jour
          - select.compteur_energie_sdb_jour
          - select.compteur_energie_wc_jour
          - select.compteur_energie_cuisine_jour
          - select.compteur_energie_mal_jour
          - sensor.compteur_energie_piscine_jour_hp_hc
        action: select.select_option
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: sensor.linky_n_tarif
          state: '2'
        - condition: state
          entity_id: sensor.linky_n_tarif
          state: '4'
        - condition: state
          entity_id: sensor.linky_n_tarif
          state: '6'
      sequence:
      - data:
          option: hp
        target:
          entity_id:
          - select.compteur_energie_pac
          - select.compteur_energie_autres_jour
          - select.compteur_energie_onduleur_jour
          - select.compteur_energie_vmc_jour
          - select.compteur_energie_sdb_jour
          - select.compteur_energie_wc_jour
          - select.compteur_energie_cuisine_jour
          - select.compteur_energie_mal_jour
          - sensor.compteur_energie_piscine_jour_hp_hc
        action: select.select_option
    default: []
  mode: single
- id: '1642958036645'
  alias: Blueprint Notification Petite Porte Sous Sol Ouverte
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.alarme_petite_porte_sous_sol
      alert_state: 'on'
      alert_action:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}}Petite Porte Sous-Sol
            ouverte après le coucher du soleil'
        action: notify.telegram
      resolved_action:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}}Petite Porte Sous-Sol
            OK'
        action: notify.telegram
      notify_message: ' Petite Porte Sous-Sol ouverte après le coucher du soleil'
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 600
      resolved_message: 'Petite Porte Sous-Sol OK '
      max_alerts: 5
      initial_delay: 300
- id: '1644765337710'
  alias: 00 Démarrage System
  description: ''
  triggers:
  - event: start
    trigger: homeassistant
  conditions: []
  actions:
  - data:
      addon: a0d7b954_nut
    action: hassio.addon_restart
  mode: single
- id: '1653294353395'
  alias: Sous sol position ouverte
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.porte_ssol_ouverte
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - data:
      confident: true
      position: 100
      position_type: target
      entity_id: cover.porte_sous_sol
    action: cover_rf_time_based.set_known_position
  mode: single
- id: '1653294805612'
  alias: Garage position fermee
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.porte_garage_fermee
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - data:
      confident: true
      position: 0
      position_type: target
      entity_id: cover.porte_garage
    action: cover_rf_time_based.set_known_position
  mode: single
- id: '1653294983774'
  alias: Sous sol position fermee
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.porte_ssol_fermee
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - data:
      confident: true
      position: 0
      position_type: target
      entity_id: cover.porte_sous_sol
    action: cover_rf_time_based.set_known_position
  mode: single
- id: '1653295223147'
  alias: Garage position ouverte
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.porte_garage_ouverte
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - data:
      confident: true
      position: 100
      position_type: target
      entity_id: cover.porte_garage
    action: cover_rf_time_based.set_known_position
  mode: single
- id: '1656059504847'
  alias: Robot AMX435 Al Bp Notif Tps lames atteint
  description: Surveillance du temps d'utilisation des lame du robot
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.amx435x_temps_usage_lames_atteint
      alert_state: 'on'
      alert_action:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}}Lames robot à remplacer
            = {{states("sensor.am435x_awd_duree_d_utilisation_des_lames")}} h'
          title: Alarme Robot AMX435X!!!
        action: notify.telegram
      resolved_action:
      - data:
          message: '{{states("sensor.date_time") }} {{-"\n"-}}Fin notification lames
            robot à remplacer'
          title: Fin Alarme Robot AMX435X!!!
        action: notify.telegram
      notify_message: Alerte {{ entity_name }}Déclenché
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 3600
      resolved_message: Alerte {{ entity_name }} Résolu
      initial_delay: 1
      max_alerts: 10
- id: '1669919504303'
  alias: BluePrint Notification Temp basse Chalet
  description: '# Surveillance de la temperature du chalet'
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.alarme_temp_chalet_basse
      alert_state: 'on'
      alert_action:
      - data:
          message: '{{states("sensor.date_time") }} {{-"\n"-}}T° Basse Chalet ={{states("sensor.esp174_temperature_air")
            }}°C'
          title: Alarme Temperature Basse Chalet!!!
        action: notify.telegram
      resolved_action:
      - data:
          message: '{{states("sensor.date_time") }} {{-"\n"-}}T° Basse Chalet ={{states("sensor.esp174_temperature_air")
            }}°C'
          title: Fin Alarme Temperature Basse chalet !!!
        action: notify.telegram
      notify_message: ' '
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 1800
      resolved_message: ' '
      initial_delay: 300
      max_alerts: 5
- id: '1671811895133'
  alias: Spots Exterieurs Terrasse Couverte
  description: ''
  triggers:
  - device_id: 191305ef12c4538ae3dc593438f5e19d
    domain: zha
    type: remote_button_short_press
    subtype: button
    trigger: device
  - event_type: motioneye.motion_detected
    event_data:
      device_id: ae78c8213b3a95e1ef3d7ac161697e42
    trigger: event
  conditions: []
  actions:
  - type: toggle
    device_id: 216e88150c3bb7fa0e5a68ac407485f9
    entity_id: switch.spots_ext_sud
    domain: switch
  mode: single
- id: '1678531257946'
  alias: Surveillance Puissance Onduleur Bureau la nuit
  description: ''
  triggers:
  - trigger: time
    at: '23:00:00'
  conditions:
  - condition: numeric_state
    entity_id: sensor.pc_lidl_2023_c_active_power
    above: 20
  actions:
  - data:
      message: PC Bureau Allumé apres 23:00{{-"\n"-}}{{states("sensor.date_time")
        }}
    action: notify.telegram
  mode: single
- id: '1686145474191'
  alias: BleuPrint Defaut Communication FreeBox
  description: Blue Print
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.uptimekuma_freebox
      alert_state: 'off'
      alert_action:
      - data:
          message: Freebox off Line{{-"\n"-}}{{states("sensor.date_time") }}
          title: FREE NOK !!!
        action: notify.telegram
      resolved_action:
      - data:
          message: Freebox On Line{{-"\n"-}} {{states("sensor.date_time") }}
          title: FREE OK!!!
        action: notify.telegram
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 300
      max_alerts: 10
      initial_delay: 180
      notify_message: ' '
      resolved_message: ' '
- id: '1687859491524'
  alias: Température haute stérilisateur
  description: ''
  triggers:
  - entity_id: sensor.esp127_temperature
    above: 98
    trigger: numeric_state
  conditions: []
  actions:
  - data:
      message: T° = {{states('sensor.esp127_temperature') }}{{-"\n"-}}{{states("sensor.date_time")
        }}
      title: Temperature Haute Stérilisateur !!!
    action: notify.telegram
  mode: single
- id: '1690355630909'
  alias: 08 Restart Addon UPS si en défaut
  description: ''
  triggers:
  - entity_id:
    - sensor.myups_code_d_etat
    to: unavailable
    for:
      hours: 0
      minutes: 2
      seconds: 0
    trigger: state
  - entity_id:
    - binary_sensor.network_ups_tools_en_cours_d_execution
    from: 'off'
    trigger: state
  - entity_id:
    - binary_sensor.network_ups_tools_en_cours_d_execution
    to: unavailable
    trigger: state
  - entity_id:
    - binary_sensor.network_ups_tools_en_cours_d_execution
    to: unknown
    trigger: state
  - at: 00:30:00
    trigger: time
  conditions: []
  actions:
  - data:
      addon: a0d7b954_nut
    action: hassio.addon_restart
  mode: single
- id: '1690434314772'
  alias: MP2 Memorisation Production Jour
  description: ''
  triggers:
  - at: '22:05:00'
    id: '22:05'
    trigger: time
  - at: 03:48:00
    id: 3h48
    trigger: time
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 3h48
      sequence:
      - data_template:
          entity_id: input_number.mp2_memoire_estimation_production_jour
          value: '{% set a=states(''sensor.mp2_prod_vrm_total_mqtt'')|float %}  {{a
            }}'
        action: input_number.set_value
    - conditions:
      - condition: trigger
        id:
        - '22:05'
      sequence:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}} Prévi Prod PV du Jour={{states(''input_number.mp2_memoire_estimation_production_jour'')}}
            kwh{{-"\n"-}} Prod PV du Jour={{states(''sensor.mp2_total_energie_produite_jour'')}}
            kwh{{-"\n"-}} Prévi Prod PV Demain={{states(''sensor.mp2_prod_vrm_total_mqtt'')}}
            kwh{{-"\n"-}} SOC Actuel={{states(''sensor.mp2_soc_mqtt'')}} %{{-"\n"-}}
            SOC Cible= {{states(''sensor.mp2_cible_soc_par_mqtt'')}} %{{-"\n"-}}'
          title: Prévision production PV
        action: notify.telegram
  mode: single
- id: '1698053985865'
  alias: Spot Ext Cui old
  description: ''
  triggers:
  - type: opened
    device_id: 193f4cea2f12db0ab1a4d044df803df3
    entity_id: b182f27a8204167b3f3b1893ec2d2196
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: sun
    before: sunrise
    after: sunset
    enabled: true
  - condition: state
    entity_id: input_boolean.nuit_jour
    state: 'off'
  actions:
  - type: turn_on
    device_id: c7b28db8c025b2f0bd975382bc4011f0
    entity_id: 6cf8b08e53c983c0c298cedd8a864449
    domain: switch
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: c7b28db8c025b2f0bd975382bc4011f0
    entity_id: 6cf8b08e53c983c0c298cedd8a864449
    domain: switch
    enabled: true
  mode: single
- id: '1698142750238'
  alias: Notification niveau bas puits
  description: ''
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.esp174_niveau_remplissage_puit
    for:
      hours: 0
      minutes: 5
      seconds: 0
    below: 0.8
  condition: []
  action:
  - data:
      message: '{{states("sensor.date_time") }}{{-"\n"-}} Niveau Puit {{states(''sensor.esp174_niveau_puit'')}}
        ml'
      title: Niveau eau puit inferieur à 0.8 ml depuis 10mn
    action: notify.telegram
  mode: single
- id: '1698395745098'
  alias: 01 Redemarage NODERED
  description: ''
  triggers:
  - minutes: /3
    trigger: time_pattern
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.node_red_en_cours_d_execution
      for:
        hours: 0
        minutes: 0
        seconds: 0
      state: 'on'
    then: []
    else:
    - data:
        addon: a0d7b954_nodered
      action: hassio.addon_restart
  mode: single
- id: '1698923695048'
  alias: Alerte Météo actualisation
  description: ''
  trigger:
  - platform: homeassistant
    event: start
  - platform: time_pattern
    hours: /6
  - platform: time
    at: 06:30:00
  - platform: time
    at: '16:30:00'
  condition: []
  action:
  - data:
      entity_id:
      - sensor.meteo_france_alertes_81
    target:
      entity_id:
      - sensor.meteo_france_alertes_81
    action: homeassistant.update_entity
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - data:
      entity_id:
      - sensor.meteo_france_alerts_picture_today
    target:
      entity_id:
      - sensor.meteo_france_alerts_picture_today
    action: homeassistant.update_entity
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - data:
      entity_id:
      - sensor.meteo_france_alerts_picture_tomorrow
    target:
      entity_id:
      - sensor.meteo_france_alerts_picture_tomorrow
    action: homeassistant.update_entity
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - data:
      entity_id:
      - camera.mf_alerte_today
      - camera.mf_alerte_tomorrow
    target:
      entity_id:
      - camera.mf_alerte_today
      - camera.mf_alerte_tomorrow
    action: homeassistant.update_entity
  mode: single
- id: '1699429641790'
  alias: 02 Backup total HA 1:00 du matin
  description: ''
  triggers:
  - at: 02:00:00
    trigger: time
  conditions: []
  actions:
  - data:
      compressed: true
      location: truenas
    action: hassio.backup_full
  mode: single
- id: '1700469604629'
  alias: Asservissements Modes Tempo
  description: Actions en fonction du changement de modes de  Tempo
  triggers:
  - entity_id:
    - sensor.linky_n_tarif
    to: '1'
    id: HC Bleu
    trigger: state
  - entity_id:
    - sensor.linky_n_tarif
    to: '2'
    id: HP Bleu
    trigger: state
  - entity_id:
    - sensor.linky_n_tarif
    to: '3'
    id: HC Blanc
    trigger: state
  - entity_id:
    - sensor.linky_n_tarif
    to: '4'
    id: HP Blanc
    trigger: state
  - entity_id:
    - sensor.linky_n_tarif
    to: '6'
    id: hprouge
    trigger: state
  - entity_id:
    - sensor.linky_n_tarif
    id: sortiehprouge
    from: '6'
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - hprouge
      sequence:
      - action: switch.turn_on
        target:
          entity_id: switch.esp178_ent_arret_force
        data: {}
      - action: notify.telegram
        data:
          message: '{{states("sensor.date_time") }}'
          title: Passage HP ROUGE - Forçage Arret ppe Piscine
    - conditions:
      - condition: trigger
        id:
        - sortiehprouge
      sequence:
      - data:
          message: '{{states("sensor.date_time") }}'
          title: Sortie HP ROUGE
        action: notify.telegram
      - action: switch.turn_off
        target:
          entity_id:
          - switch.esp178_ent_arret_force
        data: {}
  mode: single
  trace:
    stored_traces: 15
- id: '1706170202385'
  alias: Ecran01 Actions toutes les 30 mn
  description: ''
  triggers:
  - minutes: /30
    trigger: time_pattern
  conditions: []
  actions:
  - type: turn_on
    device_id: 31203080ff3e67d781d95be03b42e98e
    entity_id: d3873f4313e0bcaae08d3a2cfca3300f
    domain: switch
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - type: turn_off
    device_id: 31203080ff3e67d781d95be03b42e98e
    entity_id: d3873f4313e0bcaae08d3a2cfca3300f
    domain: switch
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  - type: turn_off
    device_id: 31203080ff3e67d781d95be03b42e98e
    entity_id: caf58cffba51ee848ade4eaa4c57a127
    domain: light
  mode: single
- id: '1706466237260'
  alias: Volet Automatisme Général RTS
  description: 'Ete/Hiver/Absent '
  triggers:
  - entity_id:
    - input_boolean.nuit_jour
    from: 'on'
    to: 'off'
    id: jour->nuit
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  - at: input_datetime.horaire_ete_volet_ouv
    id: heure_ouv
    trigger: time
  - at: input_datetime.horaire_ete_volet_ferm
    id: heure_ferm
    trigger: time
  - entity_id:
    - input_boolean.nuit_jour
    id: nuit->jour
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  - at: input_datetime.horaire_hiver_volet_ouv
    id: ouv_hiv
    trigger: time
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.volets
        state: Auto Hiv
      - condition: trigger
        id: jour->nuit
      sequence:
      - data: {}
        action: script.1706464871250
    - conditions:
      - condition: state
        entity_id: input_select.volets
        state: Auto Hiv
      - condition: trigger
        id:
        - ouv_hiv
      sequence:
      - data: {}
        action: script.0_0_1_ouverture_volets_rts
    - conditions:
      - condition: state
        entity_id: input_select.volets
        state: Auto Ete
      - condition: trigger
        id: heure_ouv
      sequence:
      - data: {}
        action: script.0_0_1_ouverture_volets_rts
    - conditions:
      - condition: state
        entity_id: input_select.volets
        state: Auto Ete
      - condition: trigger
        id: heure_ferm
      sequence:
      - data: {}
        action: script.1706464871250
    - conditions:
      - condition: state
        entity_id: input_select.volets
        state: Absent
      - condition: trigger
        id: jour->nuit
      sequence:
      - data: {}
        action: script.0_1_0_fermeture_volets_mode_absent_rts
    - conditions:
      - condition: state
        entity_id: input_select.volets
        state: Absent
      - condition: trigger
        id: nuit->jour
      sequence:
      - data: {}
        action: script.0_1_1_ouverture_volets_mode_absent_rts
    default: []
  mode: single
- id: '1708433020641'
  alias: ECS Automatismes Général
  description: ''
  triggers:
  - entity_id:
    - input_select.ecs_ssol
    trigger: state
  - event: sunrise
    offset: 0
    id: levee_soleil
    trigger: sun
  - event: sunset
    offset: 0
    id: couche_soleil
    trigger: sun
  - at: 03:00:00
    id: a3h
    trigger: time
  - at: 05:59:00
    id: a6h
    trigger: time
  - entity_id:
    - sensor.esp126_temp_ecs
    enabled: false
    trigger: state
  - entity_id:
    - sensor.esp126_temp_ecs
    id: tempbasse
    below: input_number.ecs_seuil_bas_temp
    trigger: numeric_state
  - entity_id:
    - sensor.esp126_temp_ecs
    above: input_number.ecs_seuil_haut_temp
    trigger: numeric_state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.ecs_ssol
        state: Auto
      - condition: numeric_state
        entity_id: sensor.esp126_temp_ecs
        below: input_number.ecs_seuil_bas_temp
      - condition: trigger
        id:
        - a3h
      sequence:
      - data: {}
        action: script.ecs_on
    - conditions:
      - condition: state
        entity_id: input_select.ecs_ssol
        state: Auto
      - condition: sun
        before: sunrise
        after: sunset
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.esp126_temp_ecs
          above: input_number.ecs_seuil_haut_temp
        - condition: trigger
          id:
          - a6h
      sequence:
      - data: {}
        action: script.ecs_off_off
    - conditions:
      - condition: state
        entity_id: input_select.ecs_ssol
        state: Auto
      - condition: trigger
        id:
        - levee_soleil
      sequence:
      - data: {}
        action: script.ecs_off
    - conditions:
      - condition: state
        entity_id: input_select.ecs_ssol
        state: Auto
      - condition: trigger
        id:
        - couche_soleil
      sequence:
      - data: {}
        action: script.ecs_off_off
    - conditions:
      - condition: state
        entity_id: input_select.ecs_ssol
        state: At Forcé
      sequence:
      - data: {}
        action: script.ecs_off_off
    - conditions:
      - condition: state
        entity_id: input_select.ecs_ssol
        state: Ma Forcée
      sequence:
      - data: {}
        action: script.ecs_on
    default: []
  mode: single
  trace:
    stored_traces: 15
- id: '1710317639852'
  alias: MP2 Défaut Status Bus VE
  description: Alarme Status Bus VE
  triggers:
  - entity_id:
    - sensor.mp2_mode_fonctionnement_par_mqtt
    trigger: state
    enabled: false
  - trigger: state
    entity_id:
    - sensor.mp2_affichage_status_bus_ve
    to: unavailable
    for:
      hours: 0
      minutes: 0
      seconds: 5
  - trigger: state
    entity_id:
    - sensor.mp2_affichage_status_bus_ve
    to: unknown
    for:
      hours: 0
      minutes: 0
      seconds: 5
  - trigger: state
    entity_id:
    - sensor.mp2_affichage_status_bus_ve
    to: 'Off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  conditions: []
  actions:
  - action: persistent_notification.create
    metadata: {}
    data:
      message: ' {{states("sensor.date_time") }}{{-"\n"-}} MP2-Status Bus VE     ->
        {{states("sensor.mp2_affichage_status_bus_ve") }}'
      title: ' ALARME!! DISFONCTIONNEMENT BUS VE'
  - action: notify.telegram
    metadata: {}
    data:
      title: ALARME!! DISFONCTIONNEMENT BUS VE
      message: '    {{states("sensor.date_time") }}{{-"\n"-}} MP2-Status Bus VE ->     {{states("sensor.mp2_affichage_status_bus_ve")
        }}'
    enabled: true
  mode: single
- id: '1711527591458'
  alias: Aqara Magic Cube
  description: ''
  use_blueprint:
    path: brent/zha-aqara-magic-cube-57-actions.yaml
    input:
      remote: d77c1d0ca21349e462286aedbcc553cf
      one_to_one:
      - action: switch.toggle
        metadata: {}
        data: {}
        target:
          entity_id: switch.multiprise_ldl_2024_12_commutateur
      slide_on_two: []
      slide_on_one:
      - target:
          entity_id: switch.lumiere_salon
        data: {}
        action: switch.toggle
      cube_flip_1:
      - action: switch.toggle
        metadata: {}
        data: {}
        target:
          entity_id: switch.tc6_bp1
- id: '1711609776550'
  alias: Spot Ext Cuisine detecteur exterieur
  description: ''
  triggers:
  - type: motion
    device_id: f63a7a8078a6c8ad8bff217525241849
    entity_id: 4b474d7b778812c1ca35464b7bcb7ba0
    domain: binary_sensor
    trigger: device
    enabled: true
  - type: opened
    device_id: 193f4cea2f12db0ab1a4d044df803df3
    entity_id: b182f27a8204167b3f3b1893ec2d2196
    domain: binary_sensor
    trigger: device
    enabled: true
  - trigger: state
    entity_id:
    - binary_sensor.zone_cuisine_all_occupancy
    to: 'on'
    enabled: true
    for:
      hours: 0
      minutes: 0
      seconds: 0
    from: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.garage_ext_motion
    to: 'on'
    enabled: false
    for:
      hours: 0
      minutes: 0
      seconds: 15
  conditions:
  - condition: sun
    before: sunrise
    after: sunset
  - condition: numeric_state
    entity_id: sensor.bh1750_illuminance
    below: 10
  actions:
  - type: turn_on
    device_id: c7b28db8c025b2f0bd975382bc4011f0
    entity_id: 6cf8b08e53c983c0c298cedd8a864449
    domain: switch
  - delay:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - type: turn_off
    device_id: c7b28db8c025b2f0bd975382bc4011f0
    entity_id: 6cf8b08e53c983c0c298cedd8a864449
    domain: switch
    enabled: true
  mode: single
  trace:
    stored_traces: 15
- id: '1711979815836'
  alias: Notifications Batteries Basses & Actions
  description: ''
  use_blueprint:
    path: Blackshome/low-battery-notifications-and-actions.yaml
    input:
      notify_device:
      - 367dba31447009458e03b70e3a29b6b2
      include_time: time_enabled
      time: 08:00:00
      notify_title: Notification Batterie basse <30%
      include_easy_notify: enable_easy_notify
      include_custom_actions: disabled_custom_actions
      custom_actions:
      - data:
          message: les appareils suivant ont moins de 30% de batterie:{{-"\n"-}}{{all_sensors|replace(',
            ', '\n')| replace('!', '.') }}
          title: Probleme Batterie !!!
        action: notify.telegram
        enabled: false
      - action: notify.persistent_notification
        metadata: {}
        data:
          message: 'les appareils suivant ont moins de 30% de     batterie:{{-"\n"-}}{{all_sensors|replace('',
            '', ''\n'')| replace(''!'', ''.'') }}  '
          title: Probleme Batterie !!!
      action_button_to_do: '"{{all_sensors}}"'
      sensor_selection: enable_battery_sensors_custom_group
      button_entity: input_button.button_aide_batterie_basse
      include_button: enable_button_trigger
      battery_level: 20
      include_persistent_notification: enable_persistent_notification
      custom_group:
        entity_id:
        - sensor.bureau_power
        - sensor.cave_power
        - sensor.lywsd03mmc_cellier_batterie
        - sensor.chamb_parents_power
        - sensor.chambre_nord_power
        - sensor.batteries_chambre_ssol_zb
        - sensor.detecteur_petite_porte_sous_sol_power
        - sensor.chambre_sud_power
        - sensor.detecteur_porte_frigo_power
        - sensor.battery_sdb
        - sensor.detecteur_porte_cellier_power
        - sensor.power_terrasse2
        - sensor.zoe_battery_level
        - sensor.bp1_sonof_4d594222_power
        - sensor.climate_escalier_sous_sol_batterie
        - sensor.detecteur_porte_entree_batterie
        - sensor.lywsd03mmc_garage_batterie
        - sensor.lywsd03mmc_salon_batterie
        - sensor.afficheur_temperature_2025_01_batterie
        - sensor.afficheur_temperature_2025_02_batterie
        - sensor.detecteur_presence_2025_03_battery
        - sensor.detecteur_spot_ext_cuisine_battery
        - sensor.tze200_3towulqd_ts0601_batterie
        - sensor.detecteur_porte_frigo_batterie
      custom_group_battery_level: 30
      exclude_sensors:
        entity_id:
        - sensor.alecto_8a_01_battery_numeric
        - sensor.alecto_0a_01_battery_numeric
        - sensor.alecto_ca_01_battery_numeric
        - sensor.alecto_ws1700_0b_01_battery_numeric
        - sensor.alecto_ws1700_34_01_battery_numeric
        - sensor.am435x_awd_batterie
        - sensor.mp2_cible_soc_par_mqtt
        - sensor.iphone_batterie
        - sensor.mp2_soc_mini_mqtt
        - sensor.mp2_soc_mqtt
        - sensor.s6_pro_batterie
        - sensor.px5_battery_level
        - sensor.robot_niveau_batterie
        - sensor.robot_am435x_awd_nr_soc
        - sensor.tabxiaomi_battery_level
        - sensor.tablette_battery_level
        - sensor.mp2_soc_theorique_par_mqtt
        - sensor.myups_charge_de_la_batterie
        - sensor.iphone_de_remy_battery_level
      notify_okay_message: Super! toutes les batteries sont okay :)
- id: '1722434877942'
  alias: Camera Activation-Désactivation detection
  description: Activation detection entre 5:30 et 23:30
  triggers:
  - at: 06:00:00
    id: desactive
    trigger: time
  - at: '23:30:00'
    id: active
    trigger: time
  - trigger: homeassistant
    event: start
    id: ha
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - active
      sequence:
      - action: script.activation_camera_2
        metadata: {}
        data: {}
    - conditions:
      - condition: trigger
        id:
        - desactive
      sequence:
      - action: script.activation_camera
        metadata: {}
        data: {}
  mode: single
- id: '1724083468200'
  alias: Notification Niveau Haut
  description: ' '
  triggers:
  - entity_id:
    - binary_sensor.esp178_niv_haut
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 10
    trigger: state
  conditions: []
  actions:
  - data:
      message: Niveau Haut Piscine
      title: Avertissement
    action: notify.telegram
  mode: single
- id: '1724834782718'
  alias: Notification Status ESP178
  description: ' '
  triggers:
  - entity_id:
    - binary_sensor.esp178_status
    for:
      hours: 0
      minutes: 2
      seconds: 0
    from: 'on'
    to: 'off'
    id: decon
    trigger: state
  - entity_id:
    - binary_sensor.esp178_piscine
    for:
      hours: 0
      minutes: 0
      seconds: 10
    enabled: false
    trigger: state
  - entity_id:
    - binary_sensor.esp178_status
    from: 'off'
    to: 'on'
    id: recon
    for:
      hours: 0
      minutes: 0
      seconds: 10
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - decon
      sequence:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}} Nouveau Status ESP178=
            {{states(''binary_sensor.esp178_status'')}}{{-"\n"-}} Etat du Ping= {{states(''binary_sensor.esp178_piscine'')}}'
          title: Piscine ESP178 Deconnecté!!!
        action: notify.telegram
      - action: switch.turn_off
        target:
          entity_id: switch.pc3_lidl
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 30
          milliseconds: 0
      - action: switch.turn_on
        target:
          entity_id:
          - switch.pc3_lidl
        data: {}
    - conditions:
      - condition: trigger
        id:
        - recon
      sequence:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}} Nouveau Status ESP178=
            {{states(''binary_sensor.esp178_status'')}}{{-"\n"-}} Etat du Ping= {{states(''binary_sensor.esp178_piscine'')}}'
          title: Piscine ESP178 Reconnecté!!!
        action: notify.telegram
  mode: single
- id: '1725537112371'
  alias: Message telegram ESP142
  description: ' '
  trigger:
  - platform: state
    entity_id:
    - sensor.esp142_message_notif_telegram
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition: []
  action:
  - data:
      message: '{{states(''sensor.esp142_message_notif_telegram'')}}'
      title: Message ESP142!!!
    action: notify.telegram
  mode: single
- id: '1726147313541'
  alias: Robot AMX435 Notif Erreur
  description: ''
  triggers:
  - entity_id:
    - sensor.am435x_awd_error
    id: error
    trigger: state
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.am435x_awd_error
      state: unavailable
    enabled: false
  actions:
  - data:
      message: "{{states(\"sensor.date_time\")}} {% set er=states('sensor.am435x_awd_error')%}
        {% if er==\"no_error\" %}\n  Pas de Probleme\n{%- else -%}\n  Probleme={{er}}\n{%-
        endif%}  "
      title: Robot notification
    action: notify.telegram
  mode: single
  trace:
    stored_traces: 10
- id: '1726422825041'
  alias: Recopie Etat HA vers NR MP2
  description: Lien entre HA et le nodered du MP2
  trigger:
  - platform: time_pattern
    id: mn
    hours: /1
  - platform: state
    entity_id:
    - input_boolean.mp2_valid_ess_charge_prog_1
    - input_boolean.forcage_charge_pgm_mp2_100
    - input_number.mp2_niveau_forcage_cp1
    - sensor.linky_ptec
  condition: []
  action:
  - action: mqtt.publish
    metadata: {}
    data:
      evaluate_payload: false
      qos: '0'
      retain: false
      topic: ha/mp2/cp/validcp
      payload: '"{{ states(''input_boolean.mp2_valid_ess_charge_prog_1'') }}"'
  - action: mqtt.publish
    metadata: {}
    data:
      evaluate_payload: false
      qos: '0'
      retain: false
      topic: ha/mp2/cp/forcage100
      payload: '"{{ states(''input_boolean.forcage_charge_pgm_mp2_100'') }}"'
  - action: mqtt.publish
    metadata: {}
    data:
      evaluate_payload: false
      qos: '0'
      retain: false
      topic: ha/mp2/cp/niveauforcagecp1
      payload: '"{{ states(''input_number.mp2_niveau_forcage_cp1'') }}"'
  - action: mqtt.publish
    metadata: {}
    data:
      evaluate_payload: false
      qos: '0'
      retain: false
      topic: ha/mp2/cp/hc
      payload: '"{{ states(''sensor.linky_ptec'') }}"'
  mode: single
- id: '1726480156769'
  alias: Surveillance Puissance Chalet
  description: ''
  trigger:
  - platform: numeric_state
    entity_id:
    - sensor.esp131_pzem_chalet_puissance
    for:
      hours: 0
      minutes: 10
      seconds: 0
    above: 500
  condition: []
  action:
  - data:
      message: '{{states("sensor.date_time") }}{{-"\n"-}} Puissance Chalet > 300w
        depuis 10mn{{-"\n"-}} P= {{states(''sensor.esp131_pzem_chalet_puissance'')}}
        W'
      title: Consommation Chalet
    action: notify.telegram
  mode: single
- id: '1726480725890'
  alias: Message Journalier Recap Conso
  description: ''
  trigger:
  - platform: time
    at: '23:59:00'
  condition: []
  action:
  - data:
      message: '{{states("sensor.date_time") }}{{-"\n"-}} Conso totale= {{states(''sensor.compteur_energie_total_jour_tous_tarifs'')}}
        kW{{-"\n"-}} Bleu HC= {{states(''sensor.compteur_energie_hc_bleu_jour'')}}
        / Bleu HP= {{states(''sensor.compteur_energie_hp_bleu_jour'')}} kW{{-"\n"-}}
        Blanc HC= {{states(''sensor.compteur_energie_hc_blanc_jour'')}} / Blanc HP=
        {{states(''sensor.compteur_energie_hp_blanc_jour'')}} kW{{-"\n"-}} Rouge HC=
        {{states(''sensor.compteur_energie_hc_rouge_jour'')}} / Rouge HP= {{states(''sensor.compteur_energie_hp_rouge_jour'')}}
        kW{{-"\n"-}}'
      title: Recap Journalier Consommation Elec
    action: notify.telegram
  mode: single
- id: '1727193343831'
  alias: Reception MQTT
  description: ''
  triggers:
  - topic: ha/nrpve/
    payload: 'true'
    id: ma
    trigger: mqtt
  - topic: ha/nrpve/
    payload: 'false'
    id: at
    trigger: mqtt
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - ma
      sequence:
      - type: turn_on
        device_id: 9975bf8e5a4c6ab6d23cb5934c972ecc
        entity_id: e2ad4dd004c939fbba02a2aa31a7967c
        domain: switch
    - conditions:
      - condition: trigger
        id:
        - at
      sequence:
      - type: turn_off
        device_id: 9975bf8e5a4c6ab6d23cb5934c972ecc
        entity_id: e2ad4dd004c939fbba02a2aa31a7967c
        domain: switch
  mode: single
- id: '1728311341373'
  alias: '07 Notification: anniversaire à souhaiter'
  description: Rappel anniversaire
  triggers:
  - event: start
    offset: '7:0:0'
    entity_id: calendar.anniversaires
    trigger: calendar
    enabled: false
  - trigger: time
    at: 07:00:00
  conditions:
  - condition: state
    entity_id: calendar.anniversaires
    state: 'on'
  actions:
  - data:
      message: Il y a l'anniversaire de {{ states.calendar.anniversaires.attributes.message
        }} a souhaiter aujourd'hui
    action: notify.telegram
- id: '1729177635873'
  alias: Defaut Secteur
  description: Surveille la tension d'entrée du MP2
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.linky_umoy
    below: 50
    id: perte_secteur
  - trigger: numeric_state
    entity_id:
    - sensor.mp2_tension_entree_l1
    below: 20
  conditions: []
  actions:
  - data:
      message: '{{states("sensor.date_time") }}{{-"\n"-}} U Secteur= {{states(''sensor.linky_umoy'')}}
        V'
      title: Defaut Secteur U Linky
    action: notify.telegram
  - wait_for_trigger:
    - trigger: numeric_state
      entity_id:
      - sensor.mp2_tension_entree_l1
      above: 200
  - data:
      message: '{{states("sensor.date_time") }}{{-"\n"-}} U Secteur= {{states(''sensor.linky_umoy'')}}
        V'
      title: Retour Secteur U Linky
    action: notify.telegram
  - data:
      message: '{{states("sensor.date_time") }}{{-"\n"-}} U Secteur= {{states(''sensor.linky_umoy'')}}
        V'
      title: Defaut Secteur U Linky
    action: notify.telegram
  mode: single
- id: '1730650651996'
  alias: Comptage Energie maison tempo
  description: Attribue le comptage d’énergie maison en fonction du tarif Tempo
  triggers:
  - entity_id:
    - sensor.linky_n_tarif
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.linky_n_tarif
        state: '1'
      sequence:
      - data:
          option: HC BLEU
        action: select.select_option
        target:
          entity_id:
          - select.compteur_energie_maison_tempo
    - conditions:
      - condition: state
        entity_id: sensor.linky_n_tarif
        state: '2'
      sequence:
      - data:
          option: HP BLEU
        action: select.select_option
        target:
          entity_id:
          - select.compteur_energie_maison_tempo
    - conditions:
      - condition: state
        entity_id: sensor.linky_n_tarif
        state: '3'
      sequence:
      - data:
          option: HC BLANC
        action: select.select_option
        target:
          entity_id:
          - select.compteur_energie_maison_tempo
    - conditions:
      - condition: state
        entity_id: sensor.linky_n_tarif
        state: '4'
      sequence:
      - data:
          option: HP BLANC
        action: select.select_option
        target:
          entity_id:
          - select.compteur_energie_maison_tempo
    - conditions:
      - condition: state
        entity_id: sensor.linky_n_tarif
        state: '5'
      sequence:
      - data:
          option: HC ROUGE
        action: select.select_option
        target:
          entity_id:
          - select.compteur_energie_maison_tempo
    - conditions:
      - condition: state
        entity_id: sensor.linky_n_tarif
        state: '6'
      sequence:
      - data:
          option: HP ROUGE
        action: select.select_option
        target:
          entity_id:
          - select.compteur_energie_maison_tempo
    default: []
  mode: single
- id: '1731925188807'
  alias: Enregistrement cout reseau maison
  description: A 23:59
  triggers:
  - trigger: time
    at: '23:59:00'
  conditions: []
  actions:
  - action: notify.send_message
    data:
      message: ',{{ states(''sensor.cout_energie_tous_tarifs_maison'') }}, {{ states(''sensor.cout_energie_tous_tarifs_reseau_jour'')}}'
    target:
      entity_id: notify.file_energie2024
  mode: single
- id: '1733215941844'
  alias: Comptage Energie Reseau 6-22-6
  description: Reset à 6 et 22h, permet de se caler au mode tempo
  triggers:
  - trigger: time
    at: 06:00:00
    id: '6'
  - trigger: time
    at: '22:00:00'
    id: '22'
  conditions: []
  actions:
  - action: utility_meter.reset
    data: {}
    target:
      entity_id:
      - sensor.consomation_energie_reseau_6_22_6
  mode: single
- id: '1733389750506'
  alias: Reboot Weewx 2024
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.reboot_weewx_2024
    from: 'off'
    to: 'on'
  conditions: []
  actions:
  - action: mqtt.publish
    data:
      evaluate_payload: false
      qos: 0
      retain: false
      topic: ha/weewx/reboot
      payload: 'true'
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - action: mqtt.publish
    data:
      evaluate_payload: false
      qos: 0
      retain: false
      topic: ha/weewx/reboot
      payload: 'false'
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.reboot_weewx_2024
  mode: single
- id: '1734008684960'
  alias: Commande PC1 multi Lidl avec telecommande 3bp
  description: ''
  triggers:
  - device_id: a99b6ceefe58486a2713f82c60f9b7b8
    domain: rfxtrx
    type: command
    subtype: 'On'
    trigger: device
    id: 'on'
  - device_id: a99b6ceefe58486a2713f82c60f9b7b8
    domain: rfxtrx
    type: command
    subtype: 'Off'
    trigger: device
    id: 'off'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'on'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: switch.multiprise_ldl_2024_12_commutateur
    - conditions:
      - condition: trigger
        id:
        - 'off'
      sequence:
      - action: switch.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: switch.multiprise_ldl_2024_12_commutateur
  mode: single
- id: '1735490750135'
  alias: Activation Forcage Charge Programmée 1 si tempo Rouge
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.rte_tempo_prochaine_couleur
    to: Rouge
    id: vers_rouge
  - trigger: state
    entity_id:
    - sensor.rte_tempo_prochaine_couleur
    id: sortie_rouge
    from: Rouge
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - vers_rouge
      sequence:
      - action: switch.turn_on
        target:
          entity_id:
          - switch.schedule_e7a1a2
          - switch.schedule_6aebea
        data: {}
    - conditions:
      - condition: trigger
        id:
        - sortie_rouge
      sequence:
      - action: switch.turn_off
        target:
          entity_id:
          - switch.schedule_e7a1a2
          - switch.schedule_6aebea
        data: {}
  mode: single
- id: '1736001989085'
  alias: Le tag Porte Garage est scanné
  description: ''
  triggers:
  - trigger: tag
    tag_id: dca56861-8baf-4881-a5c8-4b99d90c3716
  conditions: []
  actions:
  - action: cover.open_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.porte_garage
  mode: single
- id: '1736002049783'
  alias: Le tag Porte sous sol est scanné
  description: ''
  triggers:
  - trigger: tag
    tag_id: 6e75d49a-ec3d-4bfc-bd4f-2d1ab41b7cb1
  conditions: []
  actions:
  - action: cover.open_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.porte_sous_sol
  mode: single
- id: '1736002677516'
  alias: Le tag Porte sous-sol 2 est scanné
  description: ''
  triggers:
  - trigger: tag
    tag_id: 297289a4-380e-4137-bbdc-b21e165e76cc
  conditions: []
  actions:
  - action: cover.open_cover
    metadata: {}
    data: {}
    target:
      entity_id: cover.porte_sous_sol
  mode: single
- id: '1737366517257'
  alias: Notification Detection Frigate
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.zone_cuisine_all_occupancy
    from: 'off'
    to: 'on'
    id: detecte
  - trigger: state
    entity_id:
    - binary_sensor.garage_ext_all_occupancy
    from: 'off'
    to: 'on'
    id: garage
  conditions:
  - condition: sun
    before: sunrise
    after: sunset
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - detecte
      sequence:
      - action: notify.telegram
        metadata: {}
        data:
          message: Detection Zone Cuisine
          title: CAMERA CUISINE
    - conditions:
      - condition: trigger
        id:
        - garage
      sequence:
      - action: notify.telegram
        metadata: {}
        data:
          message: Detection Zone GARAGE
          title: CAMERA GARAGE
- id: '1737980607664'
  alias: Debbug
  description: ''
  triggers: []
  conditions: []
  actions:
  - data:
      level: warning
      message: 'Valeur de some_integer: {{ some_integer }}, valeur de some_string:
        {{ some_string }}'
    action: system_log.write
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ some_integer + some_string }}'
      sequence:
      - data:
          message: Action choisie
        action: notify.notify
  mode: single
- id: '1738429994514'
  alias: Volets Suivi Azimuth Soleil bureau droit été
  description: Gestion progressive des volets selon le soleil et la météo
  triggers:
  - entity_id: sun.sun
    trigger: state
  - entity_id:
    - input_number.orientation_volet_bureau
    trigger: state
  - entity_id:
    - input_number.angle_exposition_volet_bureau
    trigger: state
  - entity_id:
    - input_number.elevation_mini_volets_bureaux
    trigger: state
  - entity_id:
    - weather.albi
    trigger: state
  actions:
  - variables:
      azimut_soleil: '{{ state_attr(''sun.sun'', ''azimuth'') | float }}'
      elevation_soleil: '{{ state_attr(''sun.sun'', ''elevation'') | float }}'
      orientation_volet: '{{ states(''input_number.orientation_volet_bureau'') | float
        }}'
      angle_exposition: '{{ states(''input_number.angle_exposition_volet_bureau'')
        | float }}'
      elevation_min: '{{ states(''input_number.angle_exposition_volet_bureau'') |
        float }}'
      azimut_min: '{{ orientation_volet - angle_exposition }}'
      azimut_max: '{{ orientation_volet + angle_exposition }}'
      meteo: '{{ states(''weather.albi'') }}'
  - condition: template
    value_template: '{{ azimut_min <= azimut_soleil <= azimut_max and elevation_soleil
      > elevation_min }}'
  - condition: template
    value_template: '{{ meteo in [''clear'', ''partlycloudy''] }}'
  - variables:
      fermeture: '{{ ((elevation_soleil - elevation_min) / (90 - elevation_min) *
        100) | int }}'
      position_volet: '{{ 100 - fermeture if fermeture > 0 else 100 }}'
  - target:
      entity_id: cover.bureau_droit_2
    data:
      position: '{{ position_volet }}'
    action: cover.set_cover_position
  mode: single
- id: '1738578799131'
  alias: Gestion Alim Imprimante Brother
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.uptimekuma_imp_brother
    to: 'off'
  conditions: []
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.pc2_lidl
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: switch.pc2_lidl
  mode: single
- id: '1741098557072'
  alias: Statistiques Robot am435x
  description: A 23:59
  triggers:
  - trigger: time
    at: '23:59:00'
  conditions: []
  actions:
  - action: notify.send_message
    data:
      message: '{% set tf=states(''sensor.am435x_awd_temps_de_fonctionnement_total'')|float(0)%}
        {% set tr=states(''sensor.am435x_awd_temps_de_recherche_total'')|float(0)%}
        {% set tt=states(''sensor.am435x_awd_temps_de_tonte_total'')|float(0)%} {{states("sensor.date_time")}},
        {{ (tf*24)|round(0) }}, {{ (tr/(tf*24)*100)|round(2)}}, {{ (tt/(tf*24)*100)|round(2)}},
        {{ states(''sensor.am435x_awd_distance_parcourue_totale'')|round(0) }}, {{
        states(''sensor.am435x_awd_nombre_de_cycles_de_charge'')|round(0)}}, {{ states(''sensor.am435x_awd_temps_de_charge_total'')|round(0)}},
        {{ states(''sensor.am435x_awd_nombre_de_collisions'')|round(0)}}, {{ states(''sensor.am435x_awd_duree_d_utilisation_des_lames'')|round(0)}}'
    target:
      entity_id: notify.statistique_am435x
  mode: single
- id: '1741591881874'
  alias: Energie Changement HP<->HC
  description: ''
  triggers:
  - trigger: time
    at: input_datetime.debut_heure_creuse
    id: dhc
  - trigger: time
    at: input_datetime.fin_heure_creuse
    id: fhc
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - dhc
      sequence:
      - action: select.select_option
        data:
          option: hc
        target:
          entity_id: select.compteur_energie_autres_jour
    - conditions:
      - condition: trigger
        id:
        - fhc
      sequence:
      - action: select.select_option
        data:
          option: hp
        target:
          entity_id: select.compteur_energie_autres_jour
  mode: single
- id: '1741796346707'
  alias: Rechargement Auto Automower Husqvarna
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - lawn_mower.am435x_awd
    to: unavailable
    for:
      hours: 0
      minutes: 2
      seconds: 0
  conditions: []
  actions:
  - action: homeassistant.reload_config_entry
    data:
      entry_id: husqvarna_automower
  - action: notify.telegram
    metadata: {}
    data:
      message: L'intégration Husqvarna Automower est indisponible. Tentative de rechargement
        automatique effectuée.
  mode: single
- id: solar_shutter_control_salon
  alias: Contrôle Solaire Volet Salon
  description: Ajuste le volet du salon en fonction de la position du soleil, de la
    météo et de l'occupation
  trigger:
  - platform: time_pattern
    minutes: /5
  condition:
  - condition: state
    entity_id: sun.sun
    state: above_horizon
  - condition: state
    entity_id: input_boolean.salon_control_enabled
    state: 'on'
  - condition: numeric_state
    entity_id: weather.albi
    attribute: cloud_coverage
    below: 20
  - condition: template
    value_template: '{{ state_attr(''weather.albi'', ''temperature'') | float(0) >
      states(''input_number.salon_temp_seuil'') | float(0) }}'
  - condition: or
    conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: binary_sensor.salon_occupation
        state: 'on'
    - condition: state
      entity_id: binary_sensor.salon_occupation
      state: unavailable
  action:
  - variables:
      shutter_entity: cover.volet_salon
      azimut_debut: '{{ states(''input_number.salon_azimut_debut'') | float(0) }}'
      azimut_fin: '{{ states(''input_number.salon_azimut_fin'') | float(0) }}'
      elevation_min: '{{ states(''input_number.salon_elevation_min'') | float(0) }}'
      pas: '{{ states(''input_number.salon_pas'') | float(1) }}'
      position_max: '{{ states(''input_number.salon_position_max'') | float(0) }}'
      current_azimut: '{{ state_attr(''sun.sun'', ''azimuth'') | float(0) }}'
      current_elevation: '{{ state_attr(''sun.sun'', ''elevation'') | float(0) }}'
      current_position: '{{ state_attr(''cover.volet_salon'', ''current_position'')
        | float(0) }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ current_azimut > azimut_debut and current_azimut < azimut_fin
          and current_elevation > elevation_min }}'
      sequence:
      - variables:
          azimut_range: '{{ (azimut_fin - azimut_debut) | float(1) }}'
          azimut_progress: '{{ (current_azimut - azimut_debut) / azimut_range }}'
          target_position: '{{ (azimut_progress * position_max) | round(0) }}'
          adjusted_position: '{{ (target_position / pas) | int * pas }}'
      - service: cover.set_cover_position
        target:
          entity_id: '{{ shutter_entity }}'
        data:
          position: '{{ adjusted_position | int }}'
    - conditions:
      - condition: template
        value_template: '{{ current_azimut > azimut_fin }}'
      sequence:
      - variables:
          adjusted_position: '{{ [0, current_position - pas] | max | int }}'
      - service: cover.set_cover_position
        target:
          entity_id: '{{ shutter_entity }}'
        data:
          position: '{{ adjusted_position | int }}'
- id: '1744743077040'
  alias: Alarme Seuil Haut CPU Visual Studio HA
  description: '# Si CPU Studio Code Server s''emballe'
  use_blueprint:
    path: pavax/nagging_alert_notification.yaml
    input:
      condition_entity_state: 'on'
      sensor_entity: binary_sensor.seuil_haut_cpu_studiocodeserver
      alert_state: 'on'
      alert_action:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}}Seuil HAUT CPU Glances
            HA {{states("sensor.studio_code_server_pourcentage_du_processeur")}}%'
        action: notify.telegram
      resolved_action:
      - data:
          message: '{{states("sensor.date_time") }}{{-"\n"-}}Seuil NORMAL CPU Glances
            HA {{states("sensor.studio_code_server_pourcentage_du_processeur")}}%'
        action: notify.telegram
      notify_message: ' '
      notify_device: 367dba31447009458e03b70e3a29b6b2
      repeat_delay: 60
      resolved_message: ' '
      initial_delay: 60
      max_alerts: 5
- id: '1746118040444'
  alias: Notifie sur Telegram le message ESP176 Routeur
  description: ' Notifie sur Telegram le message mis à jour par l''ESP176'
  triggers:
  - entity_id:
    - sensor.esp176_message_notif_telegram
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.esp178_message_notif_telegram
        state: unavailable
      - condition: state
        entity_id: sensor.esp178_message_notif_telegram
        state: unknown
  actions:
  - data:
      message: '{{states(''sensor.esp176_message_notif_telegram'')}}'
      title: Message ESP176!!!
    action: notify.telegram
  mode: single
- id: '1746164692289'
  alias: Ecran02- Actions toutes les 30 mn
  description: ''
  triggers:
  - minutes: /30
    trigger: time_pattern
  conditions: []
  actions:
  - type: turn_on
    device_id: d895e168f56c5b089b39c806fd2ce04b
    entity_id: 1a2c179a98b26f9d3603fa6f7978b684
    domain: switch
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - type: turn_off
    device_id: d895e168f56c5b089b39c806fd2ce04b
    entity_id: 1a2c179a98b26f9d3603fa6f7978b684
    domain: switch
  mode: single
- id: '1746555411905'
  alias: Gestion pompe piscine selon SoC batterie
  description: Force l'arrêt si SoC < 25% pendant 1 min, retour normal si SoC > 26%
  triggers:
  - trigger: state
    entity_id:
    - sensor.mp2_soc_mqtt
    for:
      hours: 0
      minutes: 0
      seconds: 0
  conditions:
  - condition: time
    after: '10:00:00'
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.mp2_soc_mqtt
        below: 25
      sequence:
      - target:
          entity_id: switch.esp178_ent_arret_force
        action: switch.turn_on
        data: {}
    - conditions:
      - condition: numeric_state
        entity_id: sensor.mp2_soc_mqtt
        above: 26
      sequence:
      - target:
          entity_id: switch.esp178_ent_arret_force
        action: switch.turn_off
        data: {}
  mode: single
