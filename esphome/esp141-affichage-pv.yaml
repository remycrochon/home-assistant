substitutions:
  device_name: esp141-affichage-pv
  adress_ip: "192.168.0.141"
  friendly_name: esp141
  time_timezone: "Europe/Paris"
  
esphome:
  name: ${device_name}
  platform: ESP8266
  board: d1_mini
  project:
    name: "rem81.Affichage_Pv"
    version: "1.0.0"
  platformio_options:
    lib_deps: NeoPixelBus@2.6.0
  on_boot:
    then:
      - light.control:
          id: rgb_led
          brightness: 0.25
          state: on  

wifi:
  networks:
    - ssid: !secret wifi_esp
      password: !secret mdpwifi_esp
      priority: 1
      
    - ssid: !secret wifi
      password: !secret mdpwifi
      priority: 0
      
  reboot_timeout: 5min
  #use_address: ${device_name}
  
  manual_ip:
    static_ip: ${adress_ip}
    gateway: 192.168.0.254
    subnet: 255.255.255.0

logger:
api:
ota:
web_server:
  port: 80

time:
  - platform: homeassistant
    timezone:  ${time_timezone} 

# Led WS2812 RGB  
light:

  - platform: neopixelbus
    method:
      type: esp8266_dma
    num_leds: 8 #1
    pin: GPIO3
    name: "RGB strip"
    variant: ws2812
    id: rgb_led
    default_transition_length: 0s  

#Etat de la connection
binary_sensor:
  - platform: gpio
    pin:
      number: GPIO16
      inverted: True
    name: bp_raz

  - platform: status
    name: "${friendly_name} Status"

  - platform: homeassistant
    name: "Conso"
    entity_id: binary_sensor.freebox_server_wan_status
    id: free_ok
 
interval:

  - interval: 0.25s
    then:
      - script.execute: calcul_led

# ------------------------  Scripts
script:
# 
# ------------------------ Calcul Led 1
  - id: calcul_led
    mode: single
    then:
      # Si 
      - if: 
          condition:
            and:
              - binary_sensor.is_on: free_ok
          then:
            - light.addressable_set:
                  id: rgb_led
                  range_from: 0
                  range_to: 0
                  red: 0%
                  green: 100%
                  blue: 0%
                  color_brightness: 100%
            - light.addressable_set:
                  id: rgb_led
                  range_from: 1
                  range_to: 7
                  red: 0%
                  green: 0%
                  blue: 0%
                  color_brightness: 0%
          else:
            - light.addressable_set:
                  id: rgb_led
                  range_from: 0
                  range_to: 0
                  red: 100%
                  green: 0%
                  blue: 0%
                  color_brightness: 100%
            - light.addressable_set:
                  id: rgb_led
                  range_from: 1
                  range_to: 7
                  red: 0%
                  green: 0%
                  blue: 0%
                  color_brightness: 0%
