substitutions:
  device_name: esp180-hotte-aspirante
  adress_ip: "192.168.0.180"
  friendly_name: esp180
  time_timezone: "Europe/Paris"
  
esphome:
  name: ${device_name}
  platform: ESP32
#  board: esp32dev
  board: mhetesp32minikit
  platformio_options:
    lib_deps: NeoPixelBus@2.6.0
    
wifi:
  networks:
    - ssid: !secret wifi
      password: !secret mdpwifi
  reboot_timeout: 5min

  manual_ip:
    static_ip: ${adress_ip}
    gateway: 192.168.0.254
    subnet: 255.255.255.0

# Enable logging
logger:
  baud_rate: 0
  level: very_verbose
#  logs:
#    light.component: very_verbose
# Enable Home Assistant API
api:

ota:

web_server:
  port: 80

# Informations supplementaires sur le WIFI
#text_sensor:
#  - platform: wifi_info
#    ip_address:
#      name: ${friendly_name}_ESP IP Address
#    ssid:
#      name: ${friendly_name}_ESP Connected SSID
#    bssid:
#      name: ${friendly_name}_ESP Connected BSSID
#    mac_address:
#      name: ${friendly_name}_ESP Mac Wifi Address
#    scan_results:
#      name: ${friendly_name}_ESP Latest Scan Results
# Led WS2812 RGB  
light:
  - platform: neopixelbus
    num_leds: 10 #1
    pin: GPIO18
    name: "Neobus"
#    variant: ws2812X
    variant: ws2812x
    id: w_led

#  - platform: esp32_rmt_led_strip
#    rgb_order: RGB
#    pin: GPIO5
#    num_leds: 6
#    rmt_channel: 0
#    chipset: ws2812
#    name: "rm_led"
#    id: w_led
#    is_rgbw: false

  - platform: partition
    name: led1
    id: led1
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 0
        to: 1
  - platform: partition
    name: led2
    id: led2
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 2
        to: 3
  - platform: partition
    name: led3
    id: led3
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 4
        to: 5
  - platform: partition
    name: led4
    id: led4
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 3
        to: 3
  - platform: partition
    name: led5
    id: led5
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 4
        to: 4
  - platform: partition
    name: led6
    id: led6
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 5
        to: 5    
  - platform: partition
    name: led7
    id: led7
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 6
        to: 6
  - platform: partition
    name: led8
    id: led8
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 7
        to: 7
  - platform: partition
    name: led9
    id: led9
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 8
        to: 8  
  - platform: partition
    name: led10
    id: led10
    default_transition_length: 0s
    segments:
      - id: w_led
        from: 9
        to: 9  






esp32_touch:
  setup_mode: false
  measurement_duration: 5.5ms

binary_sensor:
#Etat de la connection
  - platform: status
    name: "${friendly_name}_Status"

  - platform: esp32_touch
    name: "${friendly_name} BP Ma"
    pin: GPIO4
    threshold: 500
    filters:
      - delayed_on: 100ms
      - delayed_off: 100ms
    on_press:
      then:
        - switch.toggle: r1

  - platform: esp32_touch
    name: "${friendly_name} BP V1"
    pin: GPIO32
    threshold: 500
    filters:
      - delayed_on: 100ms
      - delayed_off: 100ms

  - platform: esp32_touch
    name: "${friendly_name} BP V2"
    pin: GPIO33
    threshold: 500
    filters:
      - delayed_on: 100ms
      - delayed_off: 100ms

  - platform: esp32_touch
    name: "${friendly_name} BP V3"
    pin: GPIO15
    threshold: 500
    filters:
      - delayed_on: 100ms
      - delayed_off: 100ms

  - platform: esp32_touch
    name: "${friendly_name} BP VMax"
    pin: GPIO12
    threshold: 500
    filters:
      - delayed_on: 100ms
      - delayed_off: 100ms

  - platform: esp32_touch
    name: "${friendly_name} BP Lum"
    pin: GPIO14
    threshold: 500
    filters:
      - delayed_on: 100ms
      - delayed_off: 100ms

switch:
  - platform: restart
    name: "${friendly_name} Restart"

  - platform: gpio
    name: "${friendly_name} R1"
    pin: GPIO25 
    id: r1

  - platform: gpio
    name: "${friendly_name} R2"
    pin: GPIO22
    id: r2

  - platform: gpio
    name: "${friendly_name} R3"
    pin: GPIO26
    id: r3

  - platform: gpio
    name: "${friendly_name} R4"
    pin: GPIO21
    id: r4

  - platform: gpio
    name: "${friendly_name} Buzzer"
    pin: GPIO27
    id: buzzer

#interval:
#  - interval: 1s
#    then:
#      - script.execute: calcul_led

# ------------------------  Scripts
script:
# 
#  
  - id: calcul_led
    mode: single
    then:
      - if:
          condition:
            and:
              - switch.is_on: r1
          then:
            - light.turn_on:
                id: led1
                red: 100% 
                green: 0%
                blue: 0%                
          else:
            - light.turn_off:
                id: led1

            
      - if: 
          condition:
            and:
              - switch.is_on: r2
          then:
            - light.turn_on:
                id: led2
                red: 100% 
                green: 0%
                blue: 0%                
          else:
            - light.turn_off:
                id: led2
 
      - if: 
          condition:
            and:
              - switch.is_on: r3
          then:
            - light.turn_on:
                id: led3
                red: 100% 
                green: 0%
                blue: 0%                
          else:
            - light.turn_off:
                id: led3

      - if: 
          condition:
            and:
              - switch.is_on: r4
          then:
            - light.turn_on:
                id: led4
                red: 100% 
                green: 0%
                blue: 0%                
          else:
            - light.turn_off:
                id: led4
 
