[{"id":"80434e308062bad3","type":"tab","label":"Router V1","disabled":true,"info":"","env":[]},{"id":"40d6175cad8263d9","type":"tab","label":"Flow 1","disabled":true,"info":"","env":[]},{"id":"a74e482210368225","type":"tab","label":"Robot Husq","disabled":false,"info":"","env":[]},{"id":"cd45b64fe3a46f6e","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"09a2c11826adc69d","type":"tab","label":"Victron","disabled":false,"info":"","env":[]},{"id":"b15eee11632a5b2f","type":"tab","label":"Alexa","disabled":false,"info":""},{"id":"e0023ed90a550e0f","type":"tab","label":"PID","disabled":true,"info":"","env":[]},{"id":"280b62780779cc7a","type":"tab","label":"Flow 3","disabled":false,"info":"","env":[]},{"id":"12c9ac63ed800ed0","type":"subflow","name":"Subflow 1","info":"","in":[{"x":100,"y":140,"wires":[{"id":"ec719d4d.0d54f8"}]}],"out":[{"x":760,"y":320,"wires":[{"id":"ede39236.1961f8","port":0}]}]},{"id":"2923591e.104216","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"venus-ca.crt","servername":"","verifyservercert":true,"alpnprotocol":""},{"id":"45bc8be7.a4f0a4","type":"server","name":"Home Assistant","version":5,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":"30","areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m","enableGlobalContextStore":true},{"id":"404e1c1.65f5de4","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Routeur","hideToolbar":"false","allowSwipe":"false","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"1c38fbb7.3f203c","type":"mqtt-broker","name":"MQTT Victron","broker":"192.168.0.86","port":"1883","tls":"2923591e.104216","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"3","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"35ebc542aeecc309","type":"ui_tab","name":"Routeur","icon":"dashboard","disabled":false,"hidden":false},{"id":"51584e3c2cfaa393","type":"alexa-smart-home-v3-conf","username":"rem81","mqttserver":"mq-red.cb-net.co.uk","webapiurl":"red.cb-net.co.uk","contextName":"memory"},{"id":"af1b6fc455ed5ad2","type":"modbus-client","name":"Victron","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"failureLogEnabled":true,"tcpHost":"192.168.0.86","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","serialAsciiResponseStartDelimiter":"0x3A","unit_id":"1","commandDelay":"1","clientTimeout":"2000","reconnectOnTimeout":true,"reconnectTimeout":"5000","parallelUnitIdsAllowed":true,"showWarnings":true,"showLogs":true},{"id":"0bdb21264cfecccd","type":"ui_group","name":"Routeur V2","tab":"35ebc542aeecc309","order":4,"disp":true,"width":"6","collapse":false,"className":""},{"id":"13956cf323d720cd","type":"ui_group","name":"Reseau Elec","tab":"35ebc542aeecc309","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"89831f1002789b6c","type":"mqtt-broker","name":"","broker":"192.168.0.37","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"378299f3e47d4d20","type":"ui_group","name":"Simulation","tab":"35ebc542aeecc309","order":3,"disp":true,"width":"6","collapse":false,"className":""},{"id":"99ab8dc5.f435c","type":"ui_tab","name":"HTTP","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"3e864d95339b7f4b","type":"ui_tab","name":"Free","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"cc607a8997ed764b","type":"ui_group","name":"regul","tab":"3e864d95339b7f4b","order":1,"disp":true,"width":"9","collapse":false,"className":""},{"id":"204b441c5739e272","type":"ui_group","name":"Default","tab":"35ebc542aeecc309","order":5,"disp":true,"width":"6","collapse":false,"className":""},{"id":"bd6914609246f6ae","type":"ui_group","name":"Default","tab":"35ebc542aeecc309","order":6,"disp":true,"width":"6","collapse":false,"className":""},{"id":"366fc8ec61d5b5da","type":"ui_spacer","z":"80434e308062bad3","name":"spacer","group":"204b441c5739e272","order":5,"width":1,"height":1},{"id":"731c3a588a6a6cab","type":"ui_spacer","z":"cd45b64fe3a46f6e","name":"spacer","group":"cc607a8997ed764b","order":1,"width":1,"height":1},{"id":"a7f439d7b1e0bbd4","type":"ui_group","name":"Status","tab":"55b4bf40cf1e815d","order":1,"disp":true,"width":"8","collapse":false,"className":""},{"id":"55b4bf40cf1e815d","type":"ui_tab","name":"Robot","icon":"android","order":21,"disabled":false,"hidden":false},{"id":"6779d15193c6c392","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Temps usage lames","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Temps usage lames"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"duration"},{"property":"unit_of_measurement","value":"h"},{"property":"state_class","value":"measurement"}],"resend":false,"debugEnabled":false},{"id":"48944942fa927bbe","type":"ha-device-config","name":"Robot AM435X AWD","hwVersion":"","manufacturer":"Node-RED","model":"","swVersion":""},{"id":"e7fab55faa524b31","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Activite","version":"6","entityType":"text","haConfig":[{"property":"name","value":"Robot Activite"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"mode","value":"text"},{"property":"min_length","value":""},{"property":"max_length","value":""},{"property":"pattern","value":""}],"resend":false,"debugEnabled":false},{"id":"e5d234746670cd80","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot State","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot State"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"f9645b92b6e522d7","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Niveau Batterie","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Niveau Batterie"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"battery"},{"property":"unit_of_measurement","value":"%"},{"property":"state_class","value":"measurement"}],"resend":false,"debugEnabled":false},{"id":"404217bb72f507e1","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Temps usage lames atteint","version":"6","entityType":"binary_sensor","haConfig":[{"property":"name","value":"Robot Temps usage lames atteint"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"problem"}],"resend":false,"debugEnabled":false},{"id":"9de243f15a5f25bd","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Code Erreur","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Code Erreur"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"739d0ab13ab27050","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Texte Erreur","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Texte Erreur"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"2ffc9eec9d9eb717","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot NB charges batterie","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot NB charges batterie"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"14b9f780c3b659e4","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot temps total charge batteries","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot temps total charge batteries"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"duration"},{"property":"unit_of_measurement","value":"d"},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"c48aa9bfbb417748","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot etat passe outre","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot etat passe outre"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"30bb56f858cdb1cc","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Raison pass outre","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Raison passe outre"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"e26f39bc855abe76","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Heure prochain demarrage","version":"6","entityType":"text","haConfig":[{"property":"name","value":"Robot Heure prochain demarrage"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"mode","value":"text"},{"property":"min_length","value":""},{"property":"max_length","value":""},{"property":"pattern","value":""}],"resend":false,"debugEnabled":false},{"id":"09b59215f38689ea","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Hauteur Coupe","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Hauteur Coupe"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"d7deab3b6bf350a8","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot heure Prochain Demarrage","version":"6","entityType":"text","haConfig":[{"property":"name","value":""},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"mode","value":"text"},{"property":"min_length","value":""},{"property":"max_length","value":""},{"property":"pattern","value":""}],"resend":false,"debugEnabled":false},{"id":"fbf2410fce1d4d75","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot heure prochain demarrage","version":"6","entityType":"text","haConfig":[{"property":"name","value":"Robot heure prochain demarrage"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"mode","value":"text"},{"property":"min_length","value":""},{"property":"max_length","value":""},{"property":"pattern","value":""}],"resend":false,"debugEnabled":false},{"id":"c06ae50d25527eaf","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Activité","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Activité"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"7a62b52bceaaef62","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot Heure Prochain Départ","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot Heure Prochain Départ"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"9a806d484c4abcc2","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot temps total coupe","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot temps total coupe"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"duration"},{"property":"unit_of_measurement","value":"h"},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"13d763340f510227","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot temps total fonctionnement","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot temps total fonctionnement"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"duration"},{"property":"unit_of_measurement","value":"h"},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"a070cd29d87d2b0a","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"","name":"Robot temps total recherche","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot temps total recherche"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"duration"},{"property":"unit_of_measurement","value":"h"},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"fba72586aef92101","type":"ha-entity-config","server":"45bc8be7.a4f0a4","deviceConfig":"48944942fa927bbe","name":"Robot temps total charge batteries","version":"6","entityType":"sensor","haConfig":[{"property":"name","value":"Robot temps total charge batteries"},{"property":"icon","value":""},{"property":"entity_category","value":""},{"property":"entity_picture","value":""},{"property":"device_class","value":"duration"},{"property":"unit_of_measurement","value":"h"},{"property":"state_class","value":""}],"resend":false,"debugEnabled":false},{"id":"7fe4b5c3.32e58c","type":"function","z":"12c9ac63ed800ed0","name":"30 sec RC + 20","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 30*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue + 20;\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":240,"wires":[["ae1a6e5.d4c0d9"]]},{"id":"1bacd004.9753c","type":"inject","z":"12c9ac63ed800ed0","name":"Inject -0.2 at start","repeat":"","crontab":"","once":true,"topic":"","payload":"-0.2","payloadType":"num","x":188,"y":63,"wires":[["ec719d4d.0d54f8"]]},{"id":"999a52c2.f465f","type":"function","z":"12c9ac63ed800ed0","name":"10 sec RC","func":"// Applies a simple RC low pass filter to incoming payload values\nvar tc = 10*1000;       // time constant in milliseconds\n\nvar lastValue = context.get('lastValue');\nif (typeof lastValue == \"undefined\") lastValue = msg.payload;\nvar lastTime = context.get('lastTime') || null;\nvar now = new Date();\nvar currentValue = msg.payload;\nif (lastTime === null) {\n    // first time through\n    newValue = currentValue;\n} else {\n    var dt = now - lastTime;\n    var newValue;\n    \n    if (dt > 0) {\n        var dtotc = dt / tc;\n        newValue = lastValue * (1 - dtotc) + currentValue * dtotc;\n    } else {\n        // no time has elapsed leave output the same as last time\n        newValue = lastValue;\n    }\n}\ncontext.set('lastValue', newValue);\ncontext.set('lastTime', now);\n\nmsg.payload = newValue;\nreturn msg;","outputs":1,"noerr":0,"x":504.5,"y":240,"wires":[["7fe4b5c3.32e58c"]]},{"id":"ec719d4d.0d54f8","type":"delay","z":"12c9ac63ed800ed0","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":321.5,"y":137,"wires":[["ede39236.1961f8"]]},{"id":"a823c9cf.2a6178","type":"function","z":"12c9ac63ed800ed0","name":"2 msg transport delay","func":"// stores messages in a fifo until the specified number have been received, \n// then releases them as new messages are received.\n// during the filling phase the earliest message is passed on each time \n// a message is received, but it is also left in the fifo\nvar fifoMaxLength = 2;\nvar fifo = context.get('fifo') || [];\n// push the new message onto the top of the array, messages are shifted down and\n// drop off the front\nvar length = fifo.push(msg);  // returns new length\nif (length > fifoMaxLength) {\n    newMsg = fifo.shift();\n} else {\n    // not full yet, make a copy of the msg and pass it on\n    var newMsg = JSON.parse(JSON.stringify(fifo[0]));\n}\ncontext.set('fifo', fifo);\nreturn newMsg;","outputs":1,"noerr":0,"x":340,"y":300,"wires":[["999a52c2.f465f"]]},{"id":"ae1a6e5.d4c0d9","type":"function","z":"12c9ac63ed800ed0","name":"Clear all except payload","func":"msg2 = {payload: msg.payload};\nreturn msg2;","outputs":1,"noerr":0,"x":598.5,"y":326,"wires":[[]]},{"id":"ede39236.1961f8","type":"range","z":"12c9ac63ed800ed0","minin":"0","maxin":"100","minout":"-100","maxout":"100","action":"scale","round":false,"property":"payload","name":"","x":150.5,"y":241,"wires":[["a823c9cf.2a6178"]]},{"id":"157430db99e95394","type":"http request","z":"80434e308062bad3","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[{"keyType":"msg","keyValue":"payload","valueType":"other","valueValue":""}],"x":710,"y":80,"wires":[[]]},{"id":"639f9ffd93ca2b26","type":"function","z":"80434e308062bad3","name":"function 6","func":"var value=msg.payload;\n\nif (value < 0) {\n    value = 0;\n} else if (value > 100) {\n    value = 100;\n}\n\n\nmsg.payload = \"http://192.168.0.77/?POWER=\"+value;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":60,"wires":[["77a4e217505a3ea9"]]},{"id":"77a4e217505a3ea9","type":"change","z":"80434e308062bad3","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":120,"wires":[["157430db99e95394","5ab413b870aec998","84e81bd61df98b44"]]},{"id":"5af824266c8c55c9","type":"debug","z":"80434e308062bad3","name":"M_Dimmer","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":710,"y":320,"wires":[]},{"id":"191ae87d440f397c","type":"debug","z":"80434e308062bad3","name":"PU grid","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":280,"y":180,"wires":[]},{"id":"5ab413b870aec998","type":"debug","z":"80434e308062bad3","name":"URL","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":730,"y":140,"wires":[]},{"id":"9812aea26f4fd1c8","type":"function","z":"80434e308062bad3","name":"Calcul Sortie % V1","func":"var pu = Math.abs(msg.pu);\nvar pu_net = msg.pu;\nvar S_Triac;\nvar Pas_Triac;\nvar M_Triac;\nvar Palier0 = 0;\nvar Palier1 = 15;\nvar Palier2 = 50;\nvar Palier3 = 100;\nvar Palier4 = 200;\nvar Palier5 = 300;\nvar Palier6 = 600;\nvar Palier7 = 900;\nvar etat = msg.dimmer; // Etat dimmer\n\nif (etat === \"on\") {\n\n    if (global.get('M_Triac') === undefined) {\n        global.set('M_Triac', 0);\n    }\n    S_Triac = global.get('M_Triac')\n\n    if (pu >= Palier1 && pu < Palier2) {\n        Pas_Triac = 0.5;\n    }\n    else if (pu >= Palier2 && pu < Palier3) {\n        Pas_Triac = 1;\n    }\n    else if (pu >= Palier3 && pu < Palier4) {\n        Pas_Triac = 1.5;\n    }\n    else if (pu >= Palier4 && pu < Palier5) {\n        Pas_Triac = 2;\n    }\n    else if (pu >= Palier5 && pu < Palier6) {\n        Pas_Triac = 2.5;\n    }\n    else if (pu >= Palier6 && pu < Palier7) {\n        Pas_Triac = 3;\n    }\n    else if (pu >= Palier7) {\n        Pas_Triac = 4;\n    }\n    else {\n        Pas_Triac = 0;\n    }\n\n    if (pu_net < 0) {\n        S_Triac = S_Triac + Pas_Triac;\n    } else {\n        S_Triac = S_Triac - Pas_Triac;\n    }\n\n    if (S_Triac < 1) {\n        S_Triac = 0;\n    }\n    if (S_Triac > 100) {\n        S_Triac = 100;\n    }\n    global.set('M_Triac', S_Triac);\n\n} else {\n    S_Triac = 0;\n    global.set('M_Triac', 0)\n    Pas_Triac = 0;\n}\nS_Triac = Math.trunc(S_Triac);\nmsg.payload = \"http://192.168.0.77/?POWER=\" + S_Triac;\n\nvar msg2 = { payload: Pas_Triac }\nvar msg3 = { payload: S_Triac }\nreturn [msg, msg2, msg3];","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":360,"wires":[["c03321e7925df515","77a4e217505a3ea9"],["5af824266c8c55c9","9a9fdf9d0964a0f2"],["e6cc304e3940801f","b0412c12f1b3cc56","66d186a76376bde5"]]},{"id":"9a9fdf9d0964a0f2","type":"ui_gauge","z":"80434e308062bad3","name":"","group":"0bdb21264cfecccd","order":1,"width":"3","height":"3","gtype":"gage","title":"M_Dimmer","label":"Unité","format":"{{value}}","min":0,"max":"20","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","diff":false,"className":"","x":710,"y":380,"wires":[]},{"id":"e6cc304e3940801f","type":"ui_gauge","z":"80434e308062bad3","name":"","group":"0bdb21264cfecccd","order":2,"width":"3","height":"3","gtype":"gage","title":"Sortie V1","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","diff":false,"className":"","x":700,"y":420,"wires":[]},{"id":"976fabee2a3d7f0a","type":"modbus-read","z":"80434e308062bad3","d":true,"name":"Pu grid","topic":"Pu_grid","showStatusActivities":true,"logIOActivities":false,"showErrors":false,"showWarnings":true,"unitid":"100","dataType":"HoldingRegister","adr":"820","quantity":"1","rate":"1800","rateUnit":"ms","delayOnStart":false,"startDelayTime":"5","server":"af1b6fc455ed5ad2","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":true,"x":90,"y":180,"wires":[["419ea4edcb2b4564"],[]]},{"id":"419ea4edcb2b4564","type":"function","z":"80434e308062bad3","name":"Convertion","func":"// Entrée : msg.payload (entier non signé)\n// Sortie : msg.payload (entier signé)\n\n// Récupérer la valeur de l'entier non signé\nvar unsignedInt = msg.payload;\n\n// Créer un tableau tampon (Buffer) pour stocker les données\nvar buffer = Buffer.allocUnsafe(2);\n\n// Écrire la valeur de l'entier non signé dans le tampon\nbuffer.writeUInt16BE(unsignedInt, 0);\n\n// Lire la valeur de l'entier signé depuis le tampon\nvar signedInt = buffer.readInt16BE(0);\n\n// Mettre à jour la valeur du message avec l'entier signé\nmsg.payload = signedInt;\n\n// Renvoyer le message modifié\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":130,"y":280,"wires":[["191ae87d440f397c","d4b66c566c6dd16e","16b39538cd796350","31ee3da382d37c31"]]},{"id":"9d3027929999dc98","type":"ui_slider","z":"80434e308062bad3","name":"","label":"Simul Sortie","tooltip":"","group":"378299f3e47d4d20","order":2,"width":0,"height":0,"passthru":true,"outs":"all","topic":"topic","topicType":"msg","min":"0","max":"100","step":1,"className":"","x":110,"y":60,"wires":[["639f9ffd93ca2b26"]]},{"id":"d4b66c566c6dd16e","type":"ui_chart","z":"80434e308062bad3","name":"","group":"13956cf323d720cd","order":2,"width":0,"height":0,"label":"Pu Réseau","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":710,"y":240,"wires":[[]]},{"id":"84e81bd61df98b44","type":"ui_text","z":"80434e308062bad3","group":"0bdb21264cfecccd","order":4,"width":0,"height":0,"name":"","label":"Trame","format":"{{msg.payload}}","layout":"row-spread","className":"","style":false,"font":"","fontSize":"","color":"#000000","x":690,"y":200,"wires":[]},{"id":"b0412c12f1b3cc56","type":"ui_chart","z":"80434e308062bad3","name":"","group":"0bdb21264cfecccd","order":3,"width":0,"height":0,"label":"Sortie GV1","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"15","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":710,"y":460,"wires":[[]]},{"id":"c19145cee0a13b36","type":"ui_slider","z":"80434e308062bad3","name":"","label":"Simul Puissance","tooltip":"","group":"378299f3e47d4d20","order":1,"width":0,"height":0,"passthru":true,"outs":"all","topic":"topic","topicType":"msg","min":"-1000","max":"1000","step":1,"className":"","x":130,"y":120,"wires":[["9812aea26f4fd1c8"]]},{"id":"31ee3da382d37c31","type":"change","z":"80434e308062bad3","name":"payload->Pu->dimmer","rules":[{"t":"set","p":"pu","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"dimmer","pt":"msg","to":"dimmer","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":360,"wires":[["9812aea26f4fd1c8","0b285c47bb18134f","3a5c35dd51955a6b"]]},{"id":"d84783b45970c47d","type":"comment","z":"80434e308062bad3","name":"Routeur PV","info":"","x":390,"y":20,"wires":[]},{"id":"16b39538cd796350","type":"ui_gauge","z":"80434e308062bad3","name":"","group":"0bdb21264cfecccd","order":1,"width":"3","height":"3","gtype":"gage","title":"Pu reseau","label":"W","format":"{{value}}","min":"-1000","max":"1000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","diff":false,"className":"","x":710,"y":280,"wires":[]},{"id":"c7969501e44ed04c","type":"api-current-state","z":"80434e308062bad3","name":"Etat Dimmer","server":"45bc8be7.a4f0a4","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.dimmer_on_off_4630","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":330,"y":640,"wires":[["0134b7a5612042bf"]]},{"id":"20759660eebf535e","type":"inject","z":"80434e308062bad3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":640,"wires":[["c7969501e44ed04c"]]},{"id":"0134b7a5612042bf","type":"change","z":"80434e308062bad3","name":"","rules":[{"t":"set","p":"dimmer","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":640,"wires":[[]]},{"id":"0b285c47bb18134f","type":"debug","z":"80434e308062bad3","name":"Dimmer","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"dimmer","targetType":"msg","statusVal":"payload","statusType":"auto","x":360,"y":420,"wires":[]},{"id":"c03321e7925df515","type":"debug","z":"80434e308062bad3","name":"debug 14","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":480,"y":180,"wires":[]},{"id":"66d186a76376bde5","type":"debug","z":"80434e308062bad3","name":"S_Triac","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":680,"y":520,"wires":[]},{"id":"e9b1542d08e28b05","type":"debug","z":"80434e308062bad3","name":"debug 15","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":480,"y":500,"wires":[]},{"id":"7470d41cd580b004","type":"change","z":"80434e308062bad3","d":true,"name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"M_Triac","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":500,"wires":[["e9b1542d08e28b05"]]},{"id":"33f3d5185345e2c5","type":"inject","z":"80434e308062bad3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":500,"wires":[["7470d41cd580b004","5c71c48a33d142ca"]]},{"id":"5c71c48a33d142ca","type":"random","z":"80434e308062bad3","name":"","low":"-500","high":"+500","inte":"true","property":"payload","x":140,"y":440,"wires":[[]]},{"id":"a450ec17d618eda1","type":"change","z":"80434e308062bad3","name":"","rules":[{"t":"set","p":"M_Triac","pt":"global","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":580,"wires":[[]]},{"id":"c4879603795487cb","type":"inject","z":"80434e308062bad3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":580,"wires":[["a450ec17d618eda1"]]},{"id":"ebf1ccb5e1387818","type":"server-state-changed","z":"80434e308062bad3","name":"Pu ECS","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.ecocompteur_ecs","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":700,"wires":[["8417c10d45524012","451511d8705b8df5"]]},{"id":"8417c10d45524012","type":"ui_chart","z":"80434e308062bad3","name":"","group":"13956cf323d720cd","order":2,"width":0,"height":0,"label":"Pu ECS","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"5","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":580,"y":680,"wires":[[]]},{"id":"451511d8705b8df5","type":"ui_gauge","z":"80434e308062bad3","name":"","group":"13956cf323d720cd","order":1,"width":"3","height":"3","gtype":"gage","title":"Pu ECS","label":"W","format":"{{value}}","min":"0","max":"3000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","diff":false,"className":"","x":580,"y":720,"wires":[]},{"id":"4006ea4a854f98aa","type":"http request","z":"80434e308062bad3","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[{"keyType":"msg","keyValue":"payload","valueType":"other","valueValue":""}],"x":710,"y":780,"wires":[[]]},{"id":"8b371d5c68e8ee79","type":"change","z":"80434e308062bad3","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":820,"wires":[["4006ea4a854f98aa","389e3391f73b5b14","be9e700f85749c6e"]]},{"id":"389e3391f73b5b14","type":"debug","z":"80434e308062bad3","name":"URL","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":730,"y":840,"wires":[]},{"id":"3a5c35dd51955a6b","type":"function","z":"80434e308062bad3","d":true,"name":"Calcul Sortie % V ETH01","func":"var pu = msg.pu;\nvar etat = msg.dimmer; // Etat dimmer\n\nif (etat === \"on\") {\n\n} else {\n    pu = 0;\n}\n\nmsg.payload = \"http://192.168.0.176/number/esp176_pu_reseau/set?value=\" + pu;\n\nreturn [msg];","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":840,"wires":[["8b371d5c68e8ee79"]]},{"id":"be9e700f85749c6e","type":"ui_text","z":"80434e308062bad3","group":"bd6914609246f6ae","order":4,"width":0,"height":0,"name":"","label":"Trame","format":"{{msg.payload}}","layout":"row-spread","className":"","style":false,"font":"","fontSize":"","color":"#000000","x":690,"y":900,"wires":[]},{"id":"77ebba8419fa4a4f","type":"comment","z":"80434e308062bad3","name":"Routeur PV","info":"","x":310,"y":760,"wires":[]},{"id":"1d496bcfe2f0a990","type":"debug","z":"80434e308062bad3","name":"debug 16","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":540,"y":960,"wires":[]},{"id":"c1bc0766dcf031aa","type":"random","z":"80434e308062bad3","name":"","low":"-1000","high":"100","inte":"true","property":"pu","x":240,"y":900,"wires":[["3d7d92d5825a2985","acf580088edd8190","735509710c064a54","aa01399680dac99e","496636838e0f1390"]]},{"id":"6f5677617406d2ea","type":"inject","z":"80434e308062bad3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"2","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":900,"wires":[["c1bc0766dcf031aa"]]},{"id":"3d7d92d5825a2985","type":"function","z":"80434e308062bad3","d":true,"name":"Calcul Sortie % V ETH01","func":"var pu = msg.pu;\nvar etat = msg.dimmer; // Etat dimmer\n\nif (etat === \"on\") {\n\n} else {\n    ;\n}\n\nmsg.payload = \"http://192.168.0.176/number/esp176_pu_reseau/set?value=\" + pu;\n\nreturn [msg];","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":980,"wires":[["8b371d5c68e8ee79","1d496bcfe2f0a990"]]},{"id":"f725698c4e759446","type":"change","z":"80434e308062bad3","name":"","rules":[{"t":"set","p":"url","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1040,"wires":[["a054d30b054e6b69"]]},{"id":"a054d30b054e6b69","type":"http request","z":"80434e308062bad3","name":"","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[{"keyType":"msg","keyValue":"payload","valueType":"other","valueValue":""}],"x":670,"y":1040,"wires":[[]]},{"id":"acf580088edd8190","type":"function","z":"80434e308062bad3","d":true,"name":"Calcul Sortie % V ETH01","func":"var pu = msg.pu;\nvar etat = msg.dimmer; // Etat dimmer\n\nif (etat === \"on\") {\n\n} else {\n    ;\n}\n\nmsg.payload = \"http://192.168.0.142/number/esp142_pu_reseau/set?value=\" + pu;\n\nreturn [msg];","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":1040,"wires":[["f725698c4e759446"]]},{"id":"735509710c064a54","type":"function","z":"80434e308062bad3","d":true,"name":"Calcul Sortie % ax+b","func":"var pu = msg.pu;\nvar pu_net = msg.pu;\nvar S_Triac;\nvar coefx1 = -10; //pour Striac =0\nvar coefx2 = -2000; // pour striac =100\n\nvar etat = msg.dimmer; // Etat dimmer\n\nif (etat === etat) {\n\n    if (global.get('M_Triac') === undefined) {\n        global.set('M_Triac', 0);\n    }\n    S_Triac = (100 - 0) /(coefx2-coefx1)*pu+ 0-(100-0)/(coefx2 - coefx1) * coefx1;\n\n    if (S_Triac < 1) {\n        S_Triac = 0;\n    }\n    if (S_Triac > 100) {\n        S_Triac = 100;\n    }\n    global.set('M_Triac', S_Triac);\n\n} else {\n    S_Triac = 0;\n\n}\nS_Triac = Math.trunc(S_Triac);\nmsg.payload = \"http://192.168.0.77/?POWER=\" + S_Triac;\n\n\nvar msg3 = { payload: S_Triac }\nreturn [msg, null, msg3];","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":1160,"wires":[[],[],["8c541ecd5b7ea9a1"]]},{"id":"8c541ecd5b7ea9a1","type":"debug","z":"80434e308062bad3","name":"S_Triac","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":460,"y":1160,"wires":[]},{"id":"aa01399680dac99e","type":"debug","z":"80434e308062bad3","name":"debug 17","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"pu","targetType":"msg","statusVal":"payload","statusType":"auto","x":480,"y":1100,"wires":[]},{"id":"496636838e0f1390","type":"function","z":"80434e308062bad3","name":"Calcul Sortie % coef-P","func":"var pu = msg.pu;\nvar pu_net = msg.pu;\nvar S_Triac;\nvar M_Triac;\nvar coefp = 100; //\n\nvar etat = msg.dimmer; // Etat dimmer\n\nif (etat === etat) {\n\n    if (global.get('M_Triac') === undefined) {\n        global.set('M_Triac', 0);\n        }\n    S_Triac = global.get('M_Triac');\n\n    S_Triac = S_Triac + pu/coefp*-1;\n\n    if (S_Triac < 1) {\n        S_Triac = 0;\n    }\n    if (S_Triac > 100) {\n        S_Triac = 100;\n    }\n    global.set('M_Triac', S_Triac);\n\n} else {\n    S_Triac = 0;\n\n}\nS_Triac = Math.trunc(S_Triac);\nmsg.payload = \"http://192.168.0.77/?POWER=\" + S_Triac;\n\nvar msg2 = { payload: pu / coefp * -1 }\nvar msg3 = { payload: S_Triac }\nreturn [msg, msg2, msg3];","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":1220,"wires":[[],["ef41e97123247e59"],["4433057cebf09b8e"]]},{"id":"4433057cebf09b8e","type":"debug","z":"80434e308062bad3","name":"S_Triac","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":480,"y":1280,"wires":[]},{"id":"ef41e97123247e59","type":"debug","z":"80434e308062bad3","name":"Coeff","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":470,"y":1220,"wires":[]},{"id":"d7abfdb1e66ab3c1","type":"debug","z":"40d6175cad8263d9","name":"Striac","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":650,"y":260,"wires":[]},{"id":"b9f9cb859e53b6c1","type":"http in","z":"40d6175cad8263d9","d":true,"name":"","url":"/triac","method":"get","upload":false,"swaggerDoc":"","x":100,"y":191,"wires":[["f92e81017d9e9e43"]]},{"id":"9fa0acb5e1f53588","type":"http response","z":"40d6175cad8263d9","name":"","statusCode":"200","headers":{},"x":640,"y":140,"wires":[]},{"id":"1bbdfaa0d2a5911f","type":"function","z":"40d6175cad8263d9","name":"","func":"var triac = msg.sort_triac;\nmsg.payload = { \"value\": triac };\nvar msg2 = { payload: triac }   \nreturn [msg, msg2];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":200,"wires":[["9fa0acb5e1f53588","2d7e3ff8ab80a43b"],["d7abfdb1e66ab3c1"]]},{"id":"2d7e3ff8ab80a43b","type":"debug","z":"40d6175cad8263d9","name":"D2","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":650,"y":200,"wires":[]},{"id":"4a14c2419bd0226e","type":"debug","z":"40d6175cad8263d9","name":"D1","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"s_triac","targetType":"msg","statusVal":"payload","statusType":"auto","x":630,"y":60,"wires":[]},{"id":"f92e81017d9e9e43","type":"change","z":"40d6175cad8263d9","name":"","rules":[{"t":"set","p":"sort_triac","pt":"msg","to":"mem_triac","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":140,"wires":[["1bbdfaa0d2a5911f","4a14c2419bd0226e"]]},{"id":"ec4f37957f88a213","type":"inject","z":"a74e482210368225","name":"InitialToken","props":[],"repeat":"1800","crontab":"","once":true,"onceDelay":"5","topic":"","x":130,"y":60,"wires":[["5a76f5f24753307f"]]},{"id":"ef52311e418fa6cd","type":"http request","z":"a74e482210368225","name":"http request","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":90,"y":780,"wires":[["1c85b2910f1c6f49","d89c283dd29ecf4e","1c19f3206acd6d3f","9a8a81a102fe4394","df188c7b4e9dbe37","d578d6265177fd55","c66b8add933a71fc","03f1b40c19ac3618","314d384bb09ef9d7","3470f711e1c995be","89ae5c22b9d1ca3a","45cef25d7d2981d7","679ee3366217b72b","3ba456c33f9f12c1","374b4da072f58017","ae8bf14b1172fbfe","a08c59c68fb08c0d"]]},{"id":"6b818ceca37c4778","type":"function","z":"a74e482210368225","name":"Get Mowers","func":"flow.set(\"access_token\", msg.oauth2Response.access_token);\nflow.set(\"refresh_token\", msg.oauth2Response.refresh_token);\nflow.set(\"user_id\", msg.oauth2Response.user_id)\n\nvar mytoken = flow.get(\"access_token\"); \nvar myapi = flow.get(\"api_key\"); \nvar url = \"https://api.amc.husqvarna.dev/v1/mowers\";\n\nmsg.headers = {\n\t'Authorization': 'Bearer '+mytoken,\n\t'Authorization-Provider': 'husqvarna',\n\t'X-Api-Key': myapi,\n\t'Content-Type': 'application/vnd.api+json',\n};\n\nmsg.url = url;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":130,"y":240,"wires":[["ef52311e418fa6cd"]]},{"id":"1c85b2910f1c6f49","type":"debug","z":"a74e482210368225","name":"P1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":690,"y":220,"wires":[]},{"id":"5a76f5f24753307f","type":"function","z":"a74e482210368225","name":"Credentials","func":"flow.set(\"gard_login\", \"crochonremy@gmail.com\");\nflow.set(\"gard_pass\", \"Albi_2021@\");\nflow.set(\"api_key\", \"058b271f-7d95-40c7-a5c2-c4db9c38e8e6\");\nflow.set(\"api_secret\", \"61e2d09a-1c01-4e9a-a737-3548ce059695\");\n\n\nvar mylogin = flow.get(\"gard_login\");\nvar mypass = flow.get(\"gard_pass\"); \nvar myrefresh = flow.get(\"refresh_token\"); \nvar myapi = flow.get(\"api_key\"); \nvar mysecret = flow.get(\"api_secret\"); \nmsg.oauth2Request = {\n    \"access_token_url\": \"https://api.authentication.husqvarnagroup.dev/v1/oauth2/token\",\n    \"credentials\": {\n        \"grant_type\": \"client_credentials\",\n        \"client_id\": \"058b271f-7d95-40c7-a5c2-c4db9c38e8e6\",\n        \"client_secret\": \"61e2d09a-1c01-4e9a-a737-3548ce059695\",\n        \"scope\": \"*\"\n    },\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":130,"y":180,"wires":[["88e8d4ddd3a7e099"]]},{"id":"498b21e243819b76","type":"debug","z":"a74e482210368225","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"oauth2Response","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":160,"wires":[]},{"id":"d89c283dd29ecf4e","type":"change","z":"a74e482210368225","name":"Extract Mower activity","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"mower\"].activity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":100,"y":320,"wires":[["1447135b6239d80c","11ab8c0f0293b455"]]},{"id":"0d70166c691efcee","type":"ui_text","z":"a74e482210368225","group":"a7f439d7b1e0bbd4","order":1,"width":0,"height":0,"name":"","label":"Activité:","format":"{{msg.payload}}","layout":"row-left","className":"","style":false,"font":"","fontSize":"","color":"#000000","x":580,"y":340,"wires":[]},{"id":"1c19f3206acd6d3f","type":"change","z":"a74e482210368225","name":"Extract Mower state","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"mower\"].state","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":360,"wires":[["953b9a9c8fc34f6f","8be5421ad9302033"]]},{"id":"0ec1d3574e80d05f","type":"ui_text","z":"a74e482210368225","group":"a7f439d7b1e0bbd4","order":1,"width":0,"height":0,"name":"","label":"Etat:","format":"{{msg.payload}}","layout":"row-left","className":"","style":false,"font":"","fontSize":"","color":"#000000","x":570,"y":380,"wires":[]},{"id":"9a8a81a102fe4394","type":"function","z":"a74e482210368225","d":true,"name":"2array.of.obj","func":"var newObj = {}\nlet arr = []\nvar lastDate = 0;\nvar options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };\nvar lastDateFormatted = 0;\nvar system = [msg.payload.data[0].attributes.system]\nvar mower = [msg.payload.data[0].attributes.mower]\nvar battery = [msg.payload.data[0].attributes.battery]\nvar metadata = [msg.payload.data[0].attributes.metadata]\nvar planner = [msg.payload.data[0].attributes.planner]\nvar calendar = [msg.payload.data[0].attributes.calendar.tasks[0]]\n\nnewObj = { Status: \"Name: \" + system[0].name }\narr.push(newObj)\nnewObj = { Status: \"Model: \" + system[0].model }\narr.push(newObj)\nnewObj = { Status: \"Serial: \" + system[0].serialNumber }\narr.push(newObj)\n\nnewObj = { Status: \"Override: \" + planner[0].override.action }\narr.push(newObj)\n\n//Calendar\nvar cald = \"\";\nif (calendar[0].monday == true) cald = \"M\"; else cald = \"_\";\nif (calendar[0].tuesday == true) cald += \"T\"; else cald += \"_\";\nif (calendar[0].wednesday == true) cald += \"W\"; else cald += \"_\";\nif (calendar[0].thursday == true) cald += \"T\"; else cald += \"_\";\nif (calendar[0].friday == true) cald += \"F\"; else cald += \"_\";\nif (calendar[0].saturday == true) cald += \"S\"; else cald += \"_\";\nif (calendar[0].sunday == true) cald += \"S\"; else cald += \"_\";\nnewObj = { Status: \"Calendar: \" + cald }\narr.push(newObj)\n\nnewObj = { Status: \"Connected: \" + metadata[0].connected }\narr.push(newObj)\n\nlastDate = new Date(metadata[0].statusTimestamp);\nlastDateFormatted = lastDate.toLocaleDateString('nb-NO', options);\nnewObj = { Status: \"StatusTS: \" +  lastDateFormatted}\narr.push(newObj)\n\nnewObj = {Status: \"Mode: \" + mower[0].mode}\narr.push(newObj)\nnewObj = { Status: \"Activity: \" + mower[0].activity}\narr.push(newObj)\nnewObj = { Status: \"State: \" + mower[0].state }\narr.push(newObj)\nnewObj = { Status: \"ErrorCode: \" + mower[0].errorCode }\narr.push(newObj)\nlastDate = new Date(mower[0].errorCodeTimestamp);\nlastDateFormatted = lastDate.toLocaleDateString('nb-NO', options);\nnewObj = { Status: \"ErrorCodeTS: \" +  lastDateFormatted}\narr.push(newObj)\nnewObj = { Status: \"Battery: \" + battery[0].batteryPercent }\narr.push(newObj)\n\nnode.warn(arr)\nmsg.payload = arr\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":260,"wires":[["3d149980e117342a"]]},{"id":"3d149980e117342a","type":"debug","z":"a74e482210368225","d":true,"name":"P2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":690,"y":260,"wires":[]},{"id":"e598a392cac372c9","type":"ui_gauge","z":"a74e482210368225","name":"","group":"a7f439d7b1e0bbd4","order":3,"width":0,"height":0,"gtype":"gage","title":"SOC","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","diff":false,"className":"","x":590,"y":220,"wires":[]},{"id":"df188c7b4e9dbe37","type":"change","z":"a74e482210368225","name":"Extract Mower SOC batterie","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"battery\"].batteryPercent","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":440,"wires":[["e598a392cac372c9","463f71e2b2cfe1c3"]]},{"id":"d578d6265177fd55","type":"change","z":"a74e482210368225","name":"Extract Mower temps lames","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"statistics\"].cuttingBladeUsageTime","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":680,"wires":[["db71782c2c0b140a"]]},{"id":"88e8d4ddd3a7e099","type":"oauth2","z":"a74e482210368225","name":"","container":"oauth2Response","grant_type":"set_by_credentials","access_token_url":"","authorization_endpoint":"","open_authentication":"","username":"","password":"","client_id":"","client_secret":"","scope":"","proxy":"","senderr":false,"client_credentials_in_body":true,"rejectUnauthorized":true,"headers":{},"x":330,"y":160,"wires":[["6b818ceca37c4778","498b21e243819b76"]]},{"id":"db71782c2c0b140a","type":"unit-converter","z":"a74e482210368225","category":"time","inputUnit":"s","outputUnit":"h","inputField":"payload","outputField":"payload","inputFieldType":"msg","outputFieldType":"msg","roundOutputField":false,"outputFieldDecimals":2,"statusType":"none","name":"Convertion en heure","x":460,"y":680,"wires":[["17b5474a7c65a501","582e0139a4f4a1fc","9e551daaedcc2217"]]},{"id":"17b5474a7c65a501","type":"ha-sensor","z":"a74e482210368225","name":"Robot Temps usage lame","entityConfig":"6779d15193c6c392","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":750,"y":640,"wires":[[]]},{"id":"463f71e2b2cfe1c3","type":"ha-sensor","z":"a74e482210368225","name":"Robot Niveau batterie","entityConfig":"f9645b92b6e522d7","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":740,"y":420,"wires":[[]]},{"id":"3272c8079331bff8","type":"ha-sensor","z":"a74e482210368225","name":"Robot Activite","entityConfig":"c06ae50d25527eaf","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":720,"y":300,"wires":[[]]},{"id":"8490e9ab2a51f5be","type":"ha-sensor","z":"a74e482210368225","name":"Robot State","entityConfig":"e5d234746670cd80","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":710,"y":360,"wires":[[]]},{"id":"05cac57771c7ddd8","type":"ha-binary-sensor","z":"a74e482210368225","name":"Robot Temps usage lames atteint","entityConfig":"404217bb72f507e1","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":780,"y":700,"wires":[[]]},{"id":"582e0139a4f4a1fc","type":"function","z":"a74e482210368225","name":"Seuil usage Lame","func":"if (msg.payload > 80) {\n    msg.payload = \"on\";\n} else {\n    msg.payload = \"off\";\n}\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":490,"y":720,"wires":[["05cac57771c7ddd8"]]},{"id":"c66b8add933a71fc","type":"change","z":"a74e482210368225","name":"Extract Mower Code erreur","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"mower\"].errorCode","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":720,"wires":[["42a17c5419548cf6","944d8c849d597483"]]},{"id":"42a17c5419548cf6","type":"ha-sensor","z":"a74e482210368225","name":"Robot Code Erreur","entityConfig":"9de243f15a5f25bd","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":730,"y":760,"wires":[[]]},{"id":"8be5421ad9302033","type":"debug","z":"a74e482210368225","name":"debug 18","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":440,"y":540,"wires":[]},{"id":"9c06a373b6011118","type":"ha-sensor","z":"a74e482210368225","name":"Robot Texte Erreur","entityConfig":"739d0ab13ab27050","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":730,"y":820,"wires":[[]]},{"id":"944d8c849d597483","type":"function","z":"a74e482210368225","name":"Texte Erreur","func":"var code=msg.payload;\n\n// Tableau à deux colonnes\nvar tableau = [\n    [0, \"Pas d'erreur\"],\n    [1, \"Zone de travail extérieure\"],\n    [2, \"Pas de signal de boucle\"],\n    [3, \"Mauvais signal de boucle\"],\n    [4, \"Problème de capteur de boucle, avant\"],\n    [5, \"Problème de capteur de boucle, arrière\"],\n    [6, \"Problème de capteur de boucle, gauche\"],\n    [7, \"Problème de capteur de boucle, droite\"],\n    [8, \"Code PIN erroné\"],\n    [9, \"Pris au piège\"],\n    [10, \"A l'envers\"],\n    [11, \"Batterie faible\"],\n    [12, \"Batterie vide\"],\n    [13, \"Pas de lecteur\"],\n    [14, \"Faucheuse relevée\"],\n    [15, \"Levé\"],\n    [16, \"Coincé dans la borne de recharge\"],\n    [17, \"Borne de recharge bloquée\"],\n    [18, \"Problème de capteur de collision, arrière\"],\n    [19, \"Problème de capteur de collision, avant\"],\n    [20, \"Moteur de roue bloqué, droit\"],\n    [21, \"Moteur de roue bloqué, gauche\"],\n    [22, \"Problème de roue motrice droite\"],\n    [23, \"Problème de roue motrice, gauche\"],\n    [24, \"Système de coupe bloqué\"],\n    [25, \"Système de coupe bloqué\"],\n    [26, \"Combinaison de sous-appareil invalide\"],\n    [27, \"Paramètres restaurés\"],\n    [28, \"Problème de circuit mémoire\"],\n    [29, \"Pente trop raide\"],\n    [30, \"Problème de système de charge\"],\n    [31, \"Problème bouton STOP\"],\n    [32, \"Problème de capteur d'inclinaison\"],\n    [33, \"Tondeuse inclinée\"],\n    [34, \"Coupe arrêtée - pente trop raide\"],\n    [35, \"Moteur de roue surchargé, droit\"],\n    [36, \"Moteur de roue surchargé, gauche\"],\n    [37, \"Courant de charge trop élevé\"],\n    [38, \"Problème électronique\"],\n    [39, ' Problème moteur de coupe  '],\n    [40, ' Plage de hauteur de coupe limitée'],\n    [41, ' Réglage hauteur de coupe inattendu '],\n    [42, ' Plage de hauteur de coupe limitée'],\n    [43, ' Problème de hauteur de coupe, roulez'],\n    [44, ' Problème de hauteur de coupe, courant'],\n    [45, ' Problème de hauteur de coupe, dir'],\n    [46, ' Hauteur de coupe bloquée  '],\n    [47, ' Problème de hauteur de coupe '],\n    [48, ' Pas de réponse du chargeur '],\n    [49, ' Problème d ultrasons    '],\n    [50, ' Guide 1 introuvable   '],\n    [51, ' Guide 2 introuvable   '],\n    [52, ' Guide 3 introuvable   '],\n    [53, ' Problème de navigation GPS  '],\n    [54, ' Signal GPS faible   '],\n    [55, ' Difficile de trouver sa maison '],\n    [56, ' Étalonnage du guide effectué  '],\n    [57, ' Le calibrage du guide a échoué'],\n    [58, ' Problème de batterie temporaire'],\n    [59, ' Problème de batterie temporaire'],\n    [60, ' Problème de batterie temporaire'],\n    [61, ' Problème de batterie temporaire'],\n    [62, ' Problème de batterie temporaire'],\n    [63, ' Problème de batterie temporaire'],\n    [64, ' Problème de batterie temporaire'],\n    [65, ' Problème de batterie temporaire'],\n    [66, ' Problème de batterie'],\n    [67, ' Problème de batterie'],\n    [68, ' Problème de batterie temporaire'],\n    [69, ' Alarme ! Tondeuse éteinte'],\n    [70, ' Alarme ! Tondeuse arrêtée'],\n    [71, ' Alarme ! Tondeuse relevée'],\n    [72, ' Alarme ! Tondeuse inclinée'],\n    [73, ' Alarme ! Tondeuse en mouvement '],\n    [74, ' Alarme ! Clôture géographique extérieure '],\n    [75, ' Connexion modifiée    '],\n    [76, ' Connexion NON modifiée   '],\n    [77, ' Carte com non disponible  '],\n    [78, ' Glissement - La tondeuse a glissé.Situation'],\n    [79, ' Combinaison de batteries non valide '],\n    [80, ' Déséquilibre du système de coupe Avertissement'],\n    [81, ' Fonction de sécurité défectueuse  '],\n    [82, ' Moteur de roue bloqué, arrière droit'],\n    [83, ' Moteur de roue bloqué, arrière gauche'],\n    [84, ' Problème de traction arrière droite '],\n    [85, ' Problème de roue motrice, arrière gauche'],\n    [86, ' Moteur de roue surchargé, arrière droit'],\n    [87, ' Moteur de roue surchargé, arrière gauche'],\n    [88, ' Problème de capteur angulaire  '],\n    [89, ' Configuration système invalide   '],\n    [90, ' Pas de courant dans la station'],\n    [91, ' Problème de cordon d interrupteur  '],\n    [92, ' Zone de travail non valide '],\n    [93, ' Pas de position précise des satellites'],\n    [94, ' Problème de communication avec la station'],\n    [95, ' Capteur de pliage activé  '],\n    [96, ' Moteur de brosse droite surchargé '],\n    [97, ' Moteur de brosse gauche surchargé '],\n    [98, ' Capteur à ultrasons 1 défectueux '],\n    [99, ' Capteur à ultrasons 2 défectueux '],\n    [100, ' Capteur à ultrasons 3 défectueux '],\n    [101, ' Capteur à ultrasons 4 défectueux '],\n    [102, ' Moteur d entraînement de coupe 1 défectueux'],\n    [103, ' Moteur d entraînement de coupe 2 défectueux'],\n    [104, ' Moteur d entraînement de coupe 3 défectueux'],\n    [105, ' Défaut du capteur de levage '],\n    [106, ' Capteur de collision défectueux  '],\n    [107, ' Défaut du capteur d accostage  '],\n    [108, ' Défaut du capteur du plateau de coupe repliable'],\n    [109, ' Capteur de boucle défectueux  '],\n    [110, ' Erreur du capteur de collision '],\n    [111, ' Aucune position confirmée   '],\n    [112, ' Déséquilibre majeur du système de coupe'],\n    [113, ' Zone de travail complexe  '],\n    [114, ' Courant de décharge trop élevé '],\n    [115, ' Courant interne trop élevé  '],\n    [116, ' Perte de puissance de charge élevée'],\n    [117, ' Perte de puissance interne élevée '],\n    [118, ' Problème du système de charge '],\n    [119, ' Problème de générateur de zone '],\n    [120, ' Erreur de tension interne'],\n    [121, ' Température interne élevée'],\n    [122, ' Erreur CAN'],\n    [123, ' Destination non joignable   '],\n    [124, ' Destination bloquée    '],\n    [125, ' La batterie doit être remplacée '],\n    [126, ' Batterie en fin de vie '],\n    [127, ' Problème de batterie   '],\n    [701, ' Problème de connectivité   '],\n    [702, ' Paramètres de connectivité restaurés  '],\n    [703, ' Problème de connectivité   '],\n    [704, ' Problème de connectivité   '],\n    [705, ' Problème de connectivité   '],\n    [706, ' Mauvaise qualité du signal  '],\n    [707, ' La carte SIM nécessite un code PIN'],\n    [708, ' Carte SIM verrouillée   '],\n    [709, ' Carte SIM introuvable   '],\n    [710, ' Carte SIM verrouillée   '],\n    [711, ' Carte SIM verrouillée   '],\n    [712, ' Carte SIM verrouillée   '],\n    [713, ' Problème de clôture géographique  '],\n    [714, ' Problème de clôture géographique  '],\n    [715, ' Problème de connectivité   '],\n    [716, ' Problème de connectivité   '],\n    [717, ' SMS n a pas pu être envoyé'],\n    [724, ' Le logiciel de la carte du circuit de communication doit être mis à jour     '],\n];\n\n// Fonction pour extraire la deuxième colonne en fonction de la première colonne\nfunction extraireDeuxiemeColonne(valeur) {\n    for (var i = 0; i < tableau.length; i++) {\n        if (tableau[i][0] === valeur) {\n            return tableau[i][1];\n        }\n    }\n    return \"Code Inconnu\"; // Retourne null si aucune correspondance trouvée\n}\n\n// Exemple d'utilisation\nvar valeurRecherchee = code;\nvar resultat = extraireDeuxiemeColonne(valeurRecherchee);\nmsg.payload = resultat;\n\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":490,"y":820,"wires":[["9c06a373b6011118"]]},{"id":"9e551daaedcc2217","type":"ui_text","z":"a74e482210368225","group":"a7f439d7b1e0bbd4","order":1,"width":0,"height":0,"name":"Nb H","label":"H Lames:","format":"{{msg.payload}}","layout":"row-left","className":"","style":false,"font":"","fontSize":"","color":"#000000","x":690,"y":600,"wires":[]},{"id":"03f1b40c19ac3618","type":"change","z":"a74e482210368225","name":"Extract Mower Nb Charges batterie","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"statistics\"].numberOfChargingCycles","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":400,"wires":[["39a91f579d780a48","d1f1385d60d2c239"]]},{"id":"39a91f579d780a48","type":"ha-sensor","z":"a74e482210368225","name":"Robot Nb charges batterie","entityConfig":"2ffc9eec9d9eb717","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":750,"y":480,"wires":[[]]},{"id":"314d384bb09ef9d7","type":"change","z":"a74e482210368225","name":"Extract Mower Nb de collisions","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"statistics\"].numberOfCollisions","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":190,"y":480,"wires":[["f7383f8e393bf638"]]},{"id":"f7383f8e393bf638","type":"ha-sensor","z":"a74e482210368225","name":"Robot Nb de collisions","entityConfig":"14b9f780c3b659e4","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":740,"y":540,"wires":[[]]},{"id":"1447135b6239d80c","type":"function","z":"a74e482210368225","name":"Texte actvité","func":"var code=msg.payload;\n\n// Tableau à deux colonnes\nvar tableau = [\n    ['UNKNOWN', 'Activité inconnue'],\n    ['NOT_APPLICABLE', 'Démarrage manuel requis dans la tondeuse.'],\n    ['MOWING', 'Tonte en cours'],\n    ['GOING_HOME', 'Retour Station Charge'],\n    ['CHARGING', 'Charge en cours'],\n    ['LEAVING', 'Quitte station de charge.'],\n    ['PARKED_IN_CS', 'Au Garage'],\n    ['STOPPED_IN_GARDEN', 'Arret-Manu requis'],\n];\n\n// Fonction pour extraire la deuxième colonne en fonction de la première colonne\nfunction extraireDeuxiemeColonne(valeur) {\n    for (var i = 0; i < tableau.length; i++) {\n        if (tableau[i][0] === valeur) {\n            return tableau[i][1];\n        }\n    }\n    return \"Etat Inconnu\"; // Retourne null si aucune correspondance trouvée\n}\n\n// Exemple d'utilisation\nvar valeurRecherchee = code;\nvar resultat = extraireDeuxiemeColonne(valeurRecherchee);\nmsg.payload = resultat;\n\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":620,"wires":[[]]},{"id":"6c19bd7682ab55ed","type":"debug","z":"a74e482210368225","name":"debug 19","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":400,"y":1060,"wires":[]},{"id":"33420cf7bf8f261b","type":"inject","z":"a74e482210368225","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"STOPPED","payloadType":"str","x":240,"y":620,"wires":[["1447135b6239d80c"]]},{"id":"953b9a9c8fc34f6f","type":"function","z":"a74e482210368225","name":"Texte Status","func":"var code=msg.payload;\n\n// Tableau à deux colonnes\nvar tableau = [\n    ['UNKNOWN', ' État inconnu'],\n    ['NOT_APPLICABLE', ' Non Applicable'],\n    ['PAUSED', ' Pause utilisateur'],\n    ['IN_OPERATION', ' Voir Activité'],\n    ['WAIT_UPDATING', ' Chargement firmware.'],\n    ['WAIT_POWER_UP', ' Tests mise sous tension.'],\n    ['RESTRICTED', ' AT sur Calendrier'],\n    ['OFF', ' Eteinte.'],\n    ['STOPPED', ' Action manuelle requise'],\n    ['ERROR', ' Erreur'],\n    ['FATAL_ERROR', ' Erreur'],\n    ['ERROR_AT_POWER_UP', ' Erreur'],\n];\n\n// Fonction pour extraire la deuxième colonne en fonction de la première colonne\nfunction extraireDeuxiemeColonne(valeur) {\n    for (var i = 0; i < tableau.length; i++) {\n        if (tableau[i][0] === valeur) {\n            return tableau[i][1];\n        }\n    }\n    return \"Etat Inconnu\"; // Retourne null si aucune correspondance trouvée\n}\n\n// Exemple d'utilisation\nvar valeurRecherchee = code;\nvar resultat = extraireDeuxiemeColonne(valeurRecherchee);\nmsg.payload = resultat;\n\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":360,"wires":[["0ec1d3574e80d05f","8490e9ab2a51f5be"]]},{"id":"11ab8c0f0293b455","type":"function","z":"a74e482210368225","name":"Texte actvité","func":"var code=msg.payload;\n\n// Tableau à deux colonnes\nvar tableau = [\n    ['UNKNOWN', 'Activité inconnue'],\n    ['NOT_APPLICABLE', 'Démarrage manuel requis dans la tondeuse.'],\n    ['MOWING', 'Tonte'],\n    ['GOING_HOME', 'Retour Station Charge'],\n    ['CHARGING', 'Charge en cours'],\n    ['LEAVING', 'Quitte station de charge.'],\n    ['PARKED_IN_CS', 'Au Garage'],\n    ['STOPPED_IN_GARDEN', 'Arret-Manu requis'],\n];\n\n// Fonction pour extraire la deuxième colonne en fonction de la première colonne\nfunction extraireDeuxiemeColonne(valeur) {\n    for (var i = 0; i < tableau.length; i++) {\n        if (tableau[i][0] === valeur) {\n            return tableau[i][1];\n        }\n    }\n    return \"Etat Inconnu\"; // Retourne null si aucune correspondance trouvée\n}\n\n// Exemple d'utilisation\nvar valeurRecherchee = code;\nvar resultat = extraireDeuxiemeColonne(valeurRecherchee);\nmsg.payload = resultat;\n\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":320,"wires":[["3272c8079331bff8","0d70166c691efcee"]]},{"id":"d1f1385d60d2c239","type":"ui_text","z":"a74e482210368225","group":"a7f439d7b1e0bbd4","order":1,"width":0,"height":0,"name":"","label":"NB Charges:","format":"{{msg.payload}}","layout":"row-left","className":"","style":false,"font":"","fontSize":"","color":"#000000","x":570,"y":500,"wires":[]},{"id":"3470f711e1c995be","type":"change","z":"a74e482210368225","name":"Extract Prochain départ","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"planner\"].nextStartTimestamp","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":170,"y":880,"wires":[["ca4bf2a2010a4826"]]},{"id":"89ae5c22b9d1ca3a","type":"change","z":"a74e482210368225","name":"Extract Action Passe outre","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"planner\"].override.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":940,"wires":[["2a52f93ffde06345"]]},{"id":"45cef25d7d2981d7","type":"change","z":"a74e482210368225","name":"Extract Raison Passe outre","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"planner\"].restrictedReason","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":1000,"wires":[["f98844bc671ff350","6c19bd7682ab55ed"]]},{"id":"e0395c417685a941","type":"debug","z":"a74e482210368225","name":"debug 21","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":580,"y":1520,"wires":[]},{"id":"f98844bc671ff350","type":"function","z":"a74e482210368225","name":"Texte raison passe outre","func":"var code=msg.payload;\n\n// Tableau à deux colonnes\nvar tableau = [\n    ['NONE',\"Aucune raison restreinte.\"],\n    ['WEEK_SCHEDULE',\"Il n'y a pas de tâche dans le calendrier pour le moment, rien à faire.\"],\n    ['PARK_OVERRIDE',\"La restriction est due au fait que quelqu'un nous a forcés à nous garer en utilisant la fonction de dérogation.\"],\n    ['SENSOR',\"Le capteur a décidé que l'herbe est assez courte, il n'est donc pas nécessaire de l'user encore plus.\"],\n    ['DAILY_LIMIT',\"Si un modèle a un temps de tonte maximal autorisé par jour, cette restriction s'appliquera lorsque ce temps sera écoulé.\"],\n    ['FOTA',\"Lorsqu'une mise à jour Fota est transférée sur la tondeuse, nous voulons rester dans la station de charge pour nous assurer que le transfert est réussi.La restriction est supprimée lorsque le transfert est effectué.\"],\n    ['FROST',\"Le capteur de gel pense qu'il fait trop froid pour tondre.\"],\n];\n\n// Fonction pour extraire la deuxième colonne en fonction de la première colonne\nfunction extraireDeuxiemeColonne(valeur) {\n    for (var i = 0; i < tableau.length; i++) {\n        if (tableau[i][0] === valeur) {\n            return tableau[i][1];\n        }\n    }\n    return \"Non Applicable\"; // Retourne null si aucune correspondance trouvée\n}\n\n// Exemple d'utilisation\nvar valeurRecherchee = code;\nvar resultat = extraireDeuxiemeColonne(valeurRecherchee);\nmsg.payload = resultat;\n\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1000,"wires":[["16dc6c0c821ca62f"]]},{"id":"2a52f93ffde06345","type":"function","z":"a74e482210368225","name":"Etat passe outre","func":"var code=msg.payload;\n\n// Tableau à deux colonnes\nvar tableau = [\n    ['NOT_ACTIVE','Non actif.'],\n    ['FORCE_PARK',\"Le stationnement forcé jusqu'au prochain démarrage signifie qu'aucune autre tonte ne sera effectuée dans la tâche en cours. L'opération reprendra au début de la tâche suivante à la place.\"],\n    ['FORCE_MOW',\"Forcez la tondeuse à tondre pendant la durée spécifiée. Lorsque le temps s'est écoulé, le remplacement est supprimé et le planificateur revient au calendrier à la place.\"],\n];\n\n// Fonction pour extraire la deuxième colonne en fonction de la première colonne\nfunction extraireDeuxiemeColonne(valeur) {\n    for (var i = 0; i < tableau.length; i++) {\n        if (tableau[i][0] === valeur) {\n            return tableau[i][1];\n        }\n    }\n    return \"Etat Inconnu\"; // Retourne null si aucune correspondance trouvée\n}\n\n// Exemple d'utilisation\nvar valeurRecherchee = code;\nvar resultat = extraireDeuxiemeColonne(valeurRecherchee);\nmsg.payload = resultat;\n\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":940,"wires":[["375d1d7a3bef28da"]]},{"id":"375d1d7a3bef28da","type":"ha-sensor","z":"a74e482210368225","name":"Robot Etat passe outre","entityConfig":"c48aa9bfbb417748","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":740,"y":940,"wires":[[]]},{"id":"16dc6c0c821ca62f","type":"ha-sensor","z":"a74e482210368225","name":"Robot Raison passe outre","entityConfig":"30bb56f858cdb1cc","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":750,"y":1000,"wires":[[]]},{"id":"ca4bf2a2010a4826","type":"change","z":"a74e482210368225","name":"","rules":[{"t":"set","p":"timestamp","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":860,"wires":[["4fda64fd1842643b"]]},{"id":"679ee3366217b72b","type":"change","z":"a74e482210368225","name":"Extract Hauteur coupe","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"settings\"].cuttingHeight","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":1160,"wires":[["eb1ea519d4a68583"]]},{"id":"eb1ea519d4a68583","type":"ha-sensor","z":"a74e482210368225","name":"Robot Hauteur Coupe","entityConfig":"09b59215f38689ea","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":740,"y":1160,"wires":[[]]},{"id":"4fda64fd1842643b","type":"function","z":"a74e482210368225","name":"timeConvert","func":"if ( !msg.timestamp ) msg.timestamp = Math.round(+new Date());\nvar options = {\n    year: \"2-digit\", month: \"2-digit\", day: \"2-digit\",\n    hour: \"2-digit\", minute: \"2-digit\"\n};\nvar dt = new Intl.DateTimeFormat(\"fr-FR\", options).format(msg.timestamp);\n//var dt = (dateHeurefr(msg.timestamp));\n//var dt = new Date(msg.timestamp);\n\nmsg.payload= dt;\nreturn [msg];\n\n//var options = {\n//    year: \"2-digit\", month: \"2-digit\", day: \"2-digit\",\n//    hour: \"2-digit\", minute: \"2-digit\", timeZoneName: \"short\"\n//};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":900,"wires":[["54ae01e257c835d5"]]},{"id":"54ae01e257c835d5","type":"ha-sensor","z":"a74e482210368225","name":"Robot Heure Prochain Départ","entityConfig":"7a62b52bceaaef62","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":770,"y":880,"wires":[[]]},{"id":"3ba456c33f9f12c1","type":"change","z":"a74e482210368225","name":"Extract temps total charge batteries","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"statistics\"].totalChargingTime","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":1240,"wires":[["010ba4deb33e4b5e","dab743dccd24bfcd"]]},{"id":"374b4da072f58017","type":"change","z":"a74e482210368225","name":"Extract temps total coupe","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"statistics\"].totalCuttingTime","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":170,"y":1280,"wires":[["0cc9a57ed218830f"]]},{"id":"ae8bf14b1172fbfe","type":"change","z":"a74e482210368225","name":"Extract temps total fonctionnement","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"statistics\"].totalRunningTime","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":1320,"wires":[["f91e5c408ba09f0e"]]},{"id":"a08c59c68fb08c0d","type":"change","z":"a74e482210368225","name":"Extract temps total recherche","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[\"data\"][0][\"attributes\"][\"statistics\"].totalSearchingTime","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":1360,"wires":[["7decf8cf621361c4"]]},{"id":"b8ed704d54ee675b","type":"ha-sensor","z":"a74e482210368225","name":"Robot temps total coupe","entityConfig":"9a806d484c4abcc2","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":710,"y":1300,"wires":[[]]},{"id":"9b442e39245acf9e","type":"ha-sensor","z":"a74e482210368225","name":"Robot temps total fonctionnement","entityConfig":"13d763340f510227","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":740,"y":1360,"wires":[[]]},{"id":"ecb76fdd51a539ad","type":"ha-sensor","z":"a74e482210368225","name":"Robot temps total recherche","entityConfig":"a070cd29d87d2b0a","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":720,"y":1420,"wires":[[]]},{"id":"010ba4deb33e4b5e","type":"unit-converter","z":"a74e482210368225","category":"time","inputUnit":"s","outputUnit":"h","inputField":"payload","outputField":"payload","inputFieldType":"msg","outputFieldType":"msg","roundOutputField":false,"outputFieldDecimals":2,"statusType":"none","name":"Convertion en heure","x":480,"y":1240,"wires":[["5ced91a9eaf2ad66"]]},{"id":"dab743dccd24bfcd","type":"function","z":"a74e482210368225","name":"function 7","func":"var secs = msg.payload;\nvar hours = Math.floor(secs / (60 * 60));\n\nvar divisor_for_minutes = secs % (60 * 60);\nvar minutes = Math.floor(divisor_for_minutes / 60);\n\nvar divisor_for_seconds = divisor_for_minutes % 60;\nvar seconds = Math.ceil(divisor_for_seconds);\n/*ww w.  j  av  a 2s .co m*/\nvar obj = hours+\":\"+minutes+\":\"+seconds;\nmsg.payload = obj;\nreturn [msg]","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":1520,"wires":[["e0395c417685a941"]]},{"id":"0cc9a57ed218830f","type":"unit-converter","z":"a74e482210368225","category":"time","inputUnit":"s","outputUnit":"h","inputField":"payload","outputField":"payload","inputFieldType":"msg","outputFieldType":"msg","roundOutputField":false,"outputFieldDecimals":2,"statusType":"none","name":"Convertion en heure","x":480,"y":1300,"wires":[["b8ed704d54ee675b"]]},{"id":"f91e5c408ba09f0e","type":"unit-converter","z":"a74e482210368225","category":"time","inputUnit":"s","outputUnit":"h","inputField":"payload","outputField":"payload","inputFieldType":"msg","outputFieldType":"msg","roundOutputField":false,"outputFieldDecimals":2,"statusType":"none","name":"Convertion en heure","x":480,"y":1360,"wires":[["9b442e39245acf9e"]]},{"id":"7decf8cf621361c4","type":"unit-converter","z":"a74e482210368225","category":"time","inputUnit":"s","outputUnit":"h","inputField":"payload","outputField":"payload","inputFieldType":"msg","outputFieldType":"msg","roundOutputField":false,"outputFieldDecimals":2,"statusType":"none","name":"Convertion en heure","x":480,"y":1420,"wires":[["ecb76fdd51a539ad"]]},{"id":"5ced91a9eaf2ad66","type":"ha-sensor","z":"a74e482210368225","name":"Robot temps total charge batteries","entityConfig":"fba72586aef92101","version":0,"state":"payload","stateType":"msg","attributes":[],"inputOverride":"allow","outputProperties":[],"x":740,"y":1240,"wires":[[]]},{"id":"3045032dd05817ff","type":"server-state-changed","z":"cd45b64fe3a46f6e","name":"Esp 177 Temp","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.esp177_temp","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":140,"wires":[["4d6a10d11ec6d578"]]},{"id":"4d6a10d11ec6d578","type":"ui_chart","z":"cd45b64fe3a46f6e","name":"","group":"cc607a8997ed764b","order":3,"width":0,"height":0,"label":"Temp","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"15","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":430,"y":140,"wires":[[]]},{"id":"5bbf2f80efbd1cc2","type":"server-state-changed","z":"cd45b64fe3a46f6e","name":"Esp177 S PID","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.esp177_sortie_pid","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":220,"wires":[["cb065eef44a4b197"]]},{"id":"cb065eef44a4b197","type":"ui_chart","z":"cd45b64fe3a46f6e","name":"","group":"cc607a8997ed764b","order":3,"width":0,"height":0,"label":"S PID","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"15","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":430,"y":220,"wires":[[]]},{"id":"b7e1765fb82ac45b","type":"ui_chart","z":"cd45b64fe3a46f6e","name":"","group":"cc607a8997ed764b","order":3,"width":0,"height":0,"label":"V Ventilo","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"15","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":440,"y":300,"wires":[[]]},{"id":"9f50d813f624b718","type":"server-state-changed","z":"cd45b64fe3a46f6e","name":"Esp177 Vit ventilo","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.esp177_vitesse_ventilo","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":170,"y":300,"wires":[["b7e1765fb82ac45b"]]},{"id":"ff07b4896ebbc622","type":"mqtt out","z":"09a2c11826adc69d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"1c38fbb7.3f203c","x":690,"y":300,"wires":[]},{"id":"ce60e1243314953e","type":"inject","z":"09a2c11826adc69d","name":"SOC CP0","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/0/Soc","payload":"{\"value\": 65}","payloadType":"json","x":480,"y":360,"wires":[["ff07b4896ebbc622"]],"info":"{\"value\": 7}"},{"id":"26c1000a1e1c590c","type":"debug","z":"09a2c11826adc69d","name":"IB CP1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":360,"wires":[]},{"id":"5993ff51601b7c60","type":"mqtt out","z":"09a2c11826adc69d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"1c38fbb7.3f203c","x":690,"y":80,"wires":[]},{"id":"fc8b9d48eec4c094","type":"inject","z":"09a2c11826adc69d","name":"Valid CP0","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/0/Day","payload":"{\"value\": 7}","payloadType":"json","x":480,"y":80,"wires":[["5993ff51601b7c60"]],"info":"{\"value\": 7}"},{"id":"f975dd1e67addabd","type":"mqtt out","z":"09a2c11826adc69d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"1c38fbb7.3f203c","x":690,"y":220,"wires":[]},{"id":"98a748e59d9b642f","type":"inject","z":"09a2c11826adc69d","name":"DeValid CP0","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/0/Day","payload":"{\"value\": -7}","payloadType":"json","x":490,"y":220,"wires":[["f975dd1e67addabd"]],"info":"{\"value\": 7}"},{"id":"2567a4e9dc1c20cf","type":"server-state-changed","z":"09a2c11826adc69d","name":"Valid ESS MP1","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.mp2_valid_ess_charge_prog_1","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":120,"y":200,"wires":[["54aefabb7bf91f6c"]]},{"id":"7a13488df428a0d9","type":"debug","z":"09a2c11826adc69d","name":"CP0 ON","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":140,"wires":[]},{"id":"47ded119061b67d6","type":"debug","z":"09a2c11826adc69d","name":"CP0 OFF","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":180,"wires":[]},{"id":"54aefabb7bf91f6c","type":"function","z":"09a2c11826adc69d","name":"function 1","func":"var msg1 = { topic: \"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/0/Day\", payload: { \"value\": 7 } };\nvar msg2 = { topic: \"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/0/Day\", payload: { \"value\": -7 } };\nif (msg.payload === \"on\") {\n    return [msg1];\n}\n\nif (msg.payload === \"off\") {\n   return [msg2];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":140,"wires":[["5993ff51601b7c60","7a13488df428a0d9"],["f975dd1e67addabd","47ded119061b67d6"]]},{"id":"7b897e5e43703221","type":"server-state-changed","z":"09a2c11826adc69d","name":"Niveau SOC CP1","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.mp2_niveau_soc_cp1","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"topic","propertyType":"msg","value":"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/0/Soc","valueType":"str"},{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"}],"x":120,"y":260,"wires":[["39015e25c6d577e5"]]},{"id":"139132e92d5a1d4a","type":"function","z":"09a2c11826adc69d","name":"function 2","func":"msg.payload = {\"value\": msg.payload} ;\nmsg.topic = \"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/0/Soc\";\nreturn [msg];\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":480,"y":300,"wires":[["26c1000a1e1c590c","ff07b4896ebbc622"]]},{"id":"39015e25c6d577e5","type":"change","z":"09a2c11826adc69d","name":"convert","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number($$.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":300,"wires":[["139132e92d5a1d4a"]]},{"id":"8bbf947afe690d24","type":"comment","z":"09a2c11826adc69d","name":"Charge Programmée 1","info":"# # Devalidation ESS","x":360,"y":40,"wires":[]},{"id":"4d3008ea78c107f8","type":"mqtt out","z":"09a2c11826adc69d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"1c38fbb7.3f203c","x":710,"y":680,"wires":[]},{"id":"857489ed4bdbf0c2","type":"inject","z":"09a2c11826adc69d","name":"SOC CP1","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/1/Soc","payload":"{\"value\": 65}","payloadType":"json","x":500,"y":740,"wires":[["4d3008ea78c107f8"]],"info":"{\"value\": 7}"},{"id":"f4c9ceee06a7f882","type":"debug","z":"09a2c11826adc69d","name":"IB CP1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":720,"y":740,"wires":[]},{"id":"63ec35aed9506738","type":"mqtt out","z":"09a2c11826adc69d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"1c38fbb7.3f203c","x":710,"y":460,"wires":[]},{"id":"726346acf6411170","type":"inject","z":"09a2c11826adc69d","name":"Valid CP1","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/1/Day","payload":"{\"value\": 7}","payloadType":"json","x":500,"y":460,"wires":[["63ec35aed9506738"]],"info":"{\"value\": 7}"},{"id":"a184113f07b446b7","type":"mqtt out","z":"09a2c11826adc69d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"1c38fbb7.3f203c","x":710,"y":600,"wires":[]},{"id":"6a806e5aa541e7f8","type":"inject","z":"09a2c11826adc69d","name":"DeValid CP1","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/1/Day","payload":"{\"value\": -7}","payloadType":"json","x":510,"y":600,"wires":[["a184113f07b446b7"]],"info":"{\"value\": 7}"},{"id":"8cb3c16f60f12567","type":"server-state-changed","z":"09a2c11826adc69d","name":"Valid ESS MP2","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.mp2_valid_ess_charge_prog_2","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":120,"y":560,"wires":[["5eabe779acdb0df6"]]},{"id":"15d5a65d81355a72","type":"debug","z":"09a2c11826adc69d","name":"CP1 ON","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":720,"y":520,"wires":[]},{"id":"3045bc3d72f0746c","type":"debug","z":"09a2c11826adc69d","name":"CP1 OFF","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":720,"y":560,"wires":[]},{"id":"5eabe779acdb0df6","type":"function","z":"09a2c11826adc69d","name":"function 3","func":"var msg1 = { topic: \"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/1/Day\", payload: { \"value\": 7 } };\nvar msg2 = { topic: \"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/1/Day\", payload: { \"value\": -7 } };\nif (msg.payload === \"on\") {\n    return [msg1];\n}\n\nif (msg.payload === \"off\") {\n   return [msg2];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":520,"wires":[["63ec35aed9506738","15d5a65d81355a72"],["a184113f07b446b7","3045bc3d72f0746c"]]},{"id":"23ecb9e9921613b0","type":"server-state-changed","z":"09a2c11826adc69d","name":"Niveau SOC CP2","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.mp2_niveau_soc_cp2","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"}],"x":120,"y":620,"wires":[["78ad7fa6d2ac8d3b"]]},{"id":"9815e31b23478de1","type":"function","z":"09a2c11826adc69d","name":"function 4","func":"msg.payload = {\"value\": msg.payload} ;\nmsg.topic = \"W/c0619ab1db0d/settings/0/Settings/CGwacs/BatteryLife/Schedule/Charge/1/Soc\";\nreturn [msg];\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":680,"wires":[["f4c9ceee06a7f882","4d3008ea78c107f8"]]},{"id":"78ad7fa6d2ac8d3b","type":"change","z":"09a2c11826adc69d","name":"convert","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number($$.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":680,"wires":[["9815e31b23478de1"]]},{"id":"8e14d68a038975b6","type":"comment","z":"09a2c11826adc69d","name":"Charge Programmée 2","info":"# # # Devalidation ESS","x":360,"y":420,"wires":[]},{"id":"bc3c77a635f98e7d","type":"function","z":"09a2c11826adc69d","name":"function 5","func":"msg.payload = {\"value\": msg.payload} ;\nmsg.topic = \"N/c0619ab1db0d/settings/0/Settings/CGwacs/MaxDischargePower\";\nreturn [msg];\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":800,"wires":[[]]},{"id":"ed83e23ec39c0836","type":"mqtt out","z":"09a2c11826adc69d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"1c38fbb7.3f203c","x":690,"y":840,"wires":[]},{"id":"594ff33e126226f5","type":"inject","z":"09a2c11826adc69d","name":"Max Decharge Power","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"N/c0619ab1db0d/settings/0/Settings/CGwacs/MaxDischargePower","payload":"{\"value\": 85.0}","payloadType":"json","x":320,"y":900,"wires":[["ed83e23ec39c0836","c2b3a528d7921c17"]],"info":"{\"value\": 7}"},{"id":"fb9e8649f4916988","type":"inject","z":"09a2c11826adc69d","name":"RAZ Decharge Power","props":[{"p":"topic","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"N/c0619ab1db0d/settings/0/Settings/CGwacs/MaxDischargePower","payload":"{\"value\": -1.0}","payloadType":"json","x":320,"y":840,"wires":[["ed83e23ec39c0836","c2b3a528d7921c17"]],"info":"{\"value\": 7}"},{"id":"c2b3a528d7921c17","type":"debug","z":"09a2c11826adc69d","name":"debug 12","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":700,"y":900,"wires":[]},{"id":"87532818ceed1799","type":"modbus-write","z":"09a2c11826adc69d","name":"Max puissance Charge","showStatusActivities":false,"showErrors":false,"showWarnings":true,"unitid":"100","dataType":"HoldingRegister","adr":"2704","quantity":"1","server":"af1b6fc455ed5ad2","emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":680,"y":980,"wires":[[],[]]},{"id":"925b4135db03ba28","type":"inject","z":"09a2c11826adc69d","name":"RAZ Decharge Power","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"json","x":400,"y":960,"wires":[["87532818ceed1799","80cdb07bd3abd59e"]],"info":"{\"value\": 7}"},{"id":"e4ec9e7ee9fbbe33","type":"inject","z":"09a2c11826adc69d","name":"Max Decharge Power","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"300","payloadType":"json","x":400,"y":1020,"wires":[["80cdb07bd3abd59e","87532818ceed1799"]],"info":"{\"value\": 7}"},{"id":"80cdb07bd3abd59e","type":"debug","z":"09a2c11826adc69d","name":"debug 13","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":640,"y":1060,"wires":[]},{"id":"819533dd9e3ea6fd","type":"modbus-read","z":"09a2c11826adc69d","name":"Pu Batteries","topic":"Pu_batteries","showStatusActivities":true,"logIOActivities":false,"showErrors":true,"showWarnings":true,"unitid":"100","dataType":"HoldingRegister","adr":"842","quantity":"1","rate":"10","rateUnit":"s","delayOnStart":false,"startDelayTime":"5","server":"af1b6fc455ed5ad2","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":true,"x":130,"y":1140,"wires":[["39dd1cf02820bd93"],[]]},{"id":"4fdfc3cded4b983f","type":"debug","z":"09a2c11826adc69d","name":"debug 22","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":620,"y":1180,"wires":[]},{"id":"39dd1cf02820bd93","type":"function","z":"09a2c11826adc69d","name":"Convertion","func":"// Entrée : msg.payload (entier non signé)\n// Sortie : msg.payload (entier signé)\n\n// Récupérer la valeur de l'entier non signé\nvar unsignedInt = msg.payload;\n\n// Créer un tableau tampon (Buffer) pour stocker les données\nvar buffer = Buffer.allocUnsafe(2);\n\n// Écrire la valeur de l'entier non signé dans le tampon\nbuffer.writeUInt16BE(unsignedInt, 0);\n\n// Lire la valeur de l'entier signé depuis le tampon\nvar signedInt = buffer.readInt16BE(0);\n\n// Mettre à jour la valeur du message avec l'entier signé\nmsg.payload = signedInt;\n\n// Renvoyer le message modifié\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":1160,"wires":[["4fdfc3cded4b983f"]]},{"id":"f0d03335a97fce67","type":"debug","z":"09a2c11826adc69d","name":"debug 23","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":340,"y":1220,"wires":[]},{"id":"4531a7014415fe02","type":"modbus-read","z":"09a2c11826adc69d","name":"Pu grid","topic":"Pu_grid","showStatusActivities":true,"logIOActivities":false,"showErrors":false,"showWarnings":true,"unitid":"100","dataType":"HoldingRegister","adr":"820","quantity":"1","rate":"1800","rateUnit":"ms","delayOnStart":false,"startDelayTime":"5","server":"af1b6fc455ed5ad2","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":true,"x":110,"y":1260,"wires":[["f0d03335a97fce67"],[]]},{"id":"7307b46ae97cebf6","type":"api-call-service","z":"b15eee11632a5b2f","name":"PC Lampe Desodo","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.pc1_lidl"],"data":"{  \"entity_id\": \"switch.pc1_lidl\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":40,"wires":[[]]},{"id":"f9c4a3f6781b5543","type":"api-call-service","z":"b15eee11632a5b2f","name":"LumiereSalon_On","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.lumiere_salon"],"data":"{     \"entity_id\": \"switch.lumiere_salon\"   }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":180,"wires":[[]]},{"id":"3cb0ae90068b016d","type":"api-call-service","z":"b15eee11632a5b2f","name":"LumiereSalon_Off","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.lumiere_salon"],"data":"{     \"entity_id\": \"switch.lumiere_salon\"   }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":240,"wires":[[]]},{"id":"b748189a5f1bcc90","type":"switch","z":"b15eee11632a5b2f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":220,"wires":[["f9c4a3f6781b5543"],["3cb0ae90068b016d"]]},{"id":"b5ee4fef9d01c5ac","type":"api-call-service","z":"b15eee11632a5b2f","name":"Sapin_On","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.tc6_bp1"],"data":"{     \"entity_id\": \"switch.tc6_bp1\"   }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":460,"y":320,"wires":[[]]},{"id":"2448a49144eb6c04","type":"api-call-service","z":"b15eee11632a5b2f","name":"Sapin_Off","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.tc6_bp1"],"data":"{     \"entity_id\": \"switch.tc6_bp1\"   }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":460,"y":400,"wires":[[]]},{"id":"fb15d7fcdf844ace","type":"switch","z":"b15eee11632a5b2f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":380,"wires":[["b5ee4fef9d01c5ac"],["2448a49144eb6c04"]]},{"id":"a965e850be4ba3e5","type":"switch","z":"b15eee11632a5b2f","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":80,"wires":[["7307b46ae97cebf6"],["2269b5e15ab581b9"]]},{"id":"2318c1838aca4858","type":"debug","z":"b15eee11632a5b2f","name":"P1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":310,"y":580,"wires":[]},{"id":"2269b5e15ab581b9","type":"api-call-service","z":"b15eee11632a5b2f","name":"PC Lampe Desodo","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.pc1_lidl"],"data":"{     \"entity_id\": \"switch.pc1_lidl\"   }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":100,"wires":[[]]},{"id":"354bdf026c4fccd1","type":"switch","z":"b15eee11632a5b2f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":480,"wires":[["302d0c49a7bf346f"],["4a2b3c76056362de"]]},{"id":"302d0c49a7bf346f","type":"api-call-service","z":"b15eee11632a5b2f","name":"Spots terrasse","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.spots_ext_sud"],"data":"{\"entity_id\":\"switch.spots_ext_sud\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":500,"wires":[[]]},{"id":"4a2b3c76056362de","type":"api-call-service","z":"b15eee11632a5b2f","name":"Spots terrasse","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.spots_ext_sud"],"data":"{\"entity_id\":\"switch.spots_ext_sud\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":580,"wires":[[]]},{"id":"52c7540926544728","type":"alexa-smart-home-v3","z":"b15eee11632a5b2f","conf":"51584e3c2cfaa393","device":"51168","acknowledge":true,"name":"lampe salon","topic":"","x":110,"y":280,"wires":[["b748189a5f1bcc90"]]},{"id":"531306f3d2977288","type":"alexa-smart-home-v3","z":"b15eee11632a5b2f","conf":"51584e3c2cfaa393","device":"51169","acknowledge":true,"name":"lampe terrasse","topic":"","x":118,"y":490,"wires":[["354bdf026c4fccd1"]]},{"id":"776a1b7652d620e2","type":"api-call-service","z":"b15eee11632a5b2f","name":"Ferm Volet Bureau Droit","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"script","service":"volet_bureau_droit_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":660,"wires":[[]]},{"id":"ec91845992e0d712","type":"api-call-service","z":"b15eee11632a5b2f","name":"Ferm Volet Bureau Gauche","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"script","service":"volet_bureau_gauche_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":560,"y":720,"wires":[[]]},{"id":"b9360bb01c870ebf","type":"switch","z":"b15eee11632a5b2f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":700,"wires":[["776a1b7652d620e2","ec91845992e0d712"],[]]},{"id":"dcf7daedbb6e9375","type":"alexa-smart-home-v3","z":"b15eee11632a5b2f","conf":"51584e3c2cfaa393","device":"51333","acknowledge":true,"name":"fermeture volet bureau","topic":"","x":140,"y":680,"wires":[["2318c1838aca4858","b9360bb01c870ebf"]]},{"id":"15a30110a2da14fc","type":"alexa-smart-home-v3","z":"b15eee11632a5b2f","conf":"51584e3c2cfaa393","device":"51256","acknowledge":true,"name":"ouverture volet bureau","topic":"","x":120,"y":760,"wires":[["eb8d63856c3c50e5","0e23e9480e1bfb97"]]},{"id":"eb8d63856c3c50e5","type":"debug","z":"b15eee11632a5b2f","name":"P2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":350,"y":760,"wires":[]},{"id":"9cb3a1bf1b4d5436","type":"api-call-service","z":"b15eee11632a5b2f","name":"Ouv Volet Bureau Gauche","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"script","service":"volet_bureau_gauche_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":550,"y":880,"wires":[[]]},{"id":"baf5eb8ca1527bb2","type":"api-call-service","z":"b15eee11632a5b2f","name":"Ouv Volet Bureau Droit","server":"45bc8be7.a4f0a4","version":5,"debugenabled":true,"domain":"script","service":"volet_bureau_droit_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":820,"wires":[[]]},{"id":"0e23e9480e1bfb97","type":"switch","z":"b15eee11632a5b2f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":840,"wires":[["9cb3a1bf1b4d5436","baf5eb8ca1527bb2"],[]]},{"id":"de814bc4d7d48374","type":"PID","z":"e0023ed90a550e0f","name":"","setpoint":"00","pb":"50","ti":"22","td":"20","integral_default":"0","smooth_factor":"0","max_interval":600,"enable":"1","disabled_op":"0","x":350,"y":260,"wires":[["6877f1ef53e98c7a"]]},{"id":"706edda38b71699b","type":"inject","z":"e0023ed90a550e0f","name":"Setpoint 10","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"setpoint","payload":"10","payloadType":"num","x":130,"y":300,"wires":[["de814bc4d7d48374"]]},{"id":"b832083bcba8bc29","type":"inject","z":"e0023ed90a550e0f","name":"Setpoint 0","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"setpoint","payload":"0","payloadType":"num","x":140,"y":260,"wires":[["de814bc4d7d48374"]]},{"id":"e40e119980d17c29","type":"inject","z":"e0023ed90a550e0f","name":"Setpoint -10","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"setpoint","payload":"-10","payloadType":"num","x":130,"y":220,"wires":[["de814bc4d7d48374"]]},{"id":"2db89c5893353f0e","type":"inject","z":"e0023ed90a550e0f","name":"disable","repeat":"","crontab":"","once":false,"topic":"enable","payload":"false","payloadType":"bool","x":170,"y":140,"wires":[["de814bc4d7d48374"]]},{"id":"a304c6588a64ec25","type":"inject","z":"e0023ed90a550e0f","name":"enable","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"enable","payload":"true","payloadType":"bool","x":160,"y":80,"wires":[["de814bc4d7d48374"]]},{"id":"6877f1ef53e98c7a","type":"function","z":"e0023ed90a550e0f","name":"Trame","func":"var pourcentage = msg.payload*100;\nvar msg2={payload : pourcentage}\n\npourcentage = Math.trunc(pourcentage);\n\n\nmsg.payload = \"http://192.168.0.67/?POWER=\"+pourcentage;\n\n\nreturn [msg, msg2];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":570,"y":240,"wires":[["b8e5545d3f337bbf"],["a782c4397f537714"]]},{"id":"b8e5545d3f337bbf","type":"debug","z":"e0023ed90a550e0f","name":"S PID","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":710,"y":260,"wires":[]},{"id":"12e35d6b4fd1afa2","type":"server-state-changed","z":"e0023ed90a550e0f","name":"Pu Grid","server":"45bc8be7.a4f0a4","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.mp2_grid_l1","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":380,"wires":[[]]},{"id":"fe20b0bd6dabe58e","type":"range","z":"e0023ed90a550e0f","minin":"0","maxin":"1","minout":"0","maxout":"100","action":"scale","round":false,"property":"payload","name":"Scale power","x":530,"y":340,"wires":[[]]},{"id":"a782c4397f537714","type":"debug","z":"e0023ed90a550e0f","name":"Sortie","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":710,"y":300,"wires":[]},{"id":"528a41c77fd051f6","type":"mqtt in","z":"e0023ed90a550e0f","name":"","topic":"espaltherma/ATTR","qos":"2","datatype":"auto-detect","broker":"89831f1002789b6c","nl":false,"rap":true,"rh":0,"inputs":0,"x":330,"y":460,"wires":[["782c394628d79acf","aa19e364a67c9986"]]},{"id":"782c394628d79acf","type":"debug","z":"e0023ed90a550e0f","name":"debug 7","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":540,"y":460,"wires":[]},{"id":"aa19e364a67c9986","type":"debug","z":"e0023ed90a550e0f","name":"T° Int","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload[\"Temp. ambiante intérieure (R1T)\"]","targetType":"msg","statusVal":"payload[\"Temp. ambiante intérieure (R1T)\"]","statusType":"auto","x":530,"y":500,"wires":[]}]