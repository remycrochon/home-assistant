openhasp:
  ecran02:
  ############### Page 0 All ###############
    objects:
      - obj: "p0b1"
        properties:
          "text_color": >
            {% set count = states('openhasp.ecran01','rssi')|int %}
            {% if count <= -90  %}
            {{ "#FF0000" }}
            {% elif count <= -70  %}
            {{ "#FFFF00" }}
            {% else %}
            {{ "#228B22" }}
            {% endif %}
      - obj: "p0b2"
        properties:
          "text": "{{ states('sensor.time') }}"
      - obj: "p0b6"
        properties:
          "text": "\uE2DC {{'%.1f' | format (states('sensor.vp2_temp_out') | round(1)) }}°C"
      - obj: "p0b7"
        properties:
          "text": "\uE6A1 {{'%.1f' | format (states('sensor.vp2_temp_in') | round(1)) }}°C"

      ############### Page 1 Home ###############
      # Réseau
      - obj: "p1b24" # Grid Power
        properties:
          "text": >
            {% set count = states('sensor.mp2_pu_grid_l1_ac_mppt')|int %}
            {% if count >= 1000 %}
            {{ (count/1000) |round(2)}} kW
            {% else %}
            {{ count }} W
            {% endif %}
      - obj: "p1b25" # Grid Conso
        properties:
          "text": "{{ states('sensor.mp2_energie_soutiree_du_reseau_par_jour')|int }} kWh"
            
      - obj: "p1b26" # Grid Inject
        properties:
          "text": "{{ states('sensor.mp2_energie_injectee_ds_reseau_par_jour')|int }} kWh"
      
          # Solaire
      - obj: "p1b34" # Prod Power
        properties:
          "text": >
            {% set count = states('sensor.mp2_prod_totale_mqtt')|int %}
            {% if count >= 1000 %}
            {{ (count/1000) |round(2)}} kW
            {% else %}
            {{ count }} W
            {% endif %}
      - obj: "p1b35" # Production
        properties:
          "text": "{{ states('sensor.mp2_total_energie_produite_jour')|int }} kW"
            
      - obj: "p1b36" # Prévision
        properties:
          "text": "{{ states('sensor.mp2_prod_vrm_total_mqtt')|int }} kW"

          # Batteries
      - obj: "p1b44" # Charge/Décharge
        properties:
          "text": >
            {% set count = states('sensor.mp2_pu_batteries_par_mqtt')|float %}
            {% if count >= 0 %}
              {{"\uE04D"}}
            {% else %}
              {{"\uE054"}}
            {% endif %}

      - obj: "p1b45" # Puissance
        properties:
          "text": >
            {% set count = states('sensor.mp2_pu_batteries_par_mqtt')|float*-1 %}
            {% if count|abs >= 1000 %}
            {{ (count/1000) |round(2)}} kW
            {% else %}
            {{ count }} W
            {% endif %}

      - obj: "p1b46" # SOC
        properties:
          "text": "{{ states('sensor.mp2_soc_mqtt')|int }} %"

          # Maison
      - obj: "p1b55" # Puissance
        properties:
          "text": >
            {% set count = states('sensor.mp2_conso_out1_mqtt')|float %}
            {% if count >= 1000 %}
            {{ (count/1000) |round(2)}} kW
            {% else %}
            {{ count }} W
            {% endif %}
      - obj: "p1b56" # Conso
        properties:
          "text": "{{ states('sensor.mp2_energy_conso_ac_l1_jour')|int }} kW"

          #################"  OLD"            
      - obj: "p1b36" # Prévision
        properties:
          "text": "{{ states('sensor.mp2_prod_vrm_total_mqtt')|int }} kW"

      - obj: "p2b7" # PV Energy
        properties:
          "text": '{{ states("sensor.mp2_total_energie_produite_jour") }}kWh'

      - obj: "p2b24" # Load Power
        properties:
          "text": >
            {% set count = states('sensor.mp2_conso_out1_mqtt')|int %}
            {% if count >= 1000 %}
            {{ (count/1000) |round(2)  }}kW
            {% else %}
            {{ count }}W
            {% endif %}

      - obj: "p2b15" # Load Energy
        properties:
          "text": '{{ states("sensor.mp2_energy_conso_ac_l1_jour") }}kWh'

      - obj: "p2b10" # Grid Power
        properties:
          "text": >
            {% set count = states('sensor.mp2_pu_grid_l1_ac_mppt')|int %}
            {% if count <= -1000 %}
            {{ (count/1000) |round(2)  }}kW
            {% elif count >= 1000 %}
            {{ (count/1000) |round(2)  }}kW
            {% else %}
            {{ count }}W
            {% endif %}

      - obj: "p2b27" # Charge Batteries
        properties:
          "text": 'In:{{ states("sensor.mp2_energy_charge_batteries_jour") }}kWh'

      - obj: "p2b28" # Décharge Battery
        properties:
          "text": 'Out:{{ states("sensor.mp2_energy_decharge_batteries_jour") }}kWh'


      - obj: "p2b19" # Battery Power
        properties:
          "text": >
            {% set count = states('sensor.mp2_pu_batteries_par_mqtt')|int %}
            {% if count <= -1000 %}
            {{ (count/1000) |round(2)  }}kW
            {% elif count >= 1000 %}
            {{ (count/1000) |round(2)  }}kW
            {% else %}
            {{ count }}W
            {% endif %}

      - obj: "p2b18" # Battery State Of Charge
        properties:
          "text": '{{ states("sensor.mp2_soc_mqtt") |round(0) }}%'

      - obj: "p2b30" # Grid Cost
        properties:
          "text": 'Cost: £{{ states("sensor.grid_cost") |round(2) }}'

      - obj: "p2b31" # Grid Saving
        properties:
          "text": 'Saving: £{{ states("sensor.grid_saving") |round(2) }}'

      - obj: "p2b29" # Work Mode
        properties:
          "text": 'Work Mode: {{ states("sensor.mp2_affichage_status_bus_ve") }}'

 
      - obj: "p2b38" # Battery Power Line Colour
        properties:
          "line_color": >
            {% set count = states('sensor.mp2_pu_batteries_par_mqtt')|int %}
            {% if count <= -1600  %}
            {{ "#FF0000" }}
            {% elif count <= -1500  %}
            {{ "#FF1100" }}
            {% elif count <= -1400  %}
            {{ "#FF2200" }}
            {% elif count <= -1300  %}
            {{ "#FF3300" }}
            {% elif count <= -1200  %}
            {{ "#FF4400" }}
            {% elif count <= -1100  %}
            {{ "#FF5500" }}
            {% elif count <= -1000  %}
            {{ "#FF6600" }}
            {% elif count <= -900  %}
            {{ "#FF7700" }}
            {% elif count <= -800  %}
            {{ "#FF8800" }}
            {% elif count <= -700  %}
            {{ "#FF9900" }}
            {% elif count <= -600  %}
            {{ "#FFAA00" }}
            {% elif count <= -500  %}
            {{ "#FFBB00" }}
            {% elif count <= -400  %}
            {{ "#FFCC00" }}
            {% elif count <= -300  %}
            {{ "#FFDD00" }}
            {% elif count <= -200  %}
            {{ "#FFEE00" }}
            {% elif count <= -100  %}
            {{ "#FFFF00" }}
            {% elif count <= -0  %}
            {{ "#EEFF00" }}
            {% elif count <= 100  %}
            {{ "#DDFF00" }}
            {% elif count <= 200  %}
            {{ "#CCFF00" }}
            {% elif count <= 300  %}
            {{ "#BBFF00" }}
            {% elif count <= 400  %}
            {{ "#AAFF00" }}
            {% elif count <= 500  %}
            {{ "#99FF00" }}
            {% elif count <= 600  %}
            {{ "#88FF00" }}
            {% elif count <= 700  %}
            {{ "#77FF00" }}
            {% elif count <= 800  %}
            {{ "#66FF00" }}
            {% elif count <= 900  %}
            {{ "#55FF00" }}
            {% elif count <= 1000  %}
            {{ "#44FF00" }}
            {% elif count <= 1100  %}
            {{ "#33FF00" }}
            {% elif count <= 1200  %}
            {{ "#22FF00" }}
            {% elif count <= 1300  %}
            {{ "#11FF00" }}
            {% else %}
            {{ "#00FF00" }}
            {% endif %}
      - obj: "p2b39" # Grid Power Direction Line
        properties:
          "line_color": >
            {% set count = states('sensor.mp2_pu_grid_l1_ac_mppt')|int %}
            {% if count <= -1600  %}
            {{ "#00FF00" }}
            {% elif count <= -1500  %}
            {{ "#11FF00" }}
            {% elif count <= -1400  %}
            {{ "#22FF00" }}
            {% elif count <= -1300  %}
            {{ "#33FF00" }}
            {% elif count <= -1200  %}
            {{ "#44FF00" }}
            {% elif count <= -1100  %}
            {{ "#55FF00" }}
            {% elif count <= -1000  %}
            {{ "#66FF00" }}
            {% elif count <= -900  %}
            {{ "#77FF00" }}
            {% elif count <= -800  %}
            {{ "#88FF00" }}
            {% elif count <= -700  %}
            {{ "#99FF00" }}
            {% elif count <= -600  %}
            {{ "#AAFF00" }}
            {% elif count <= -500  %}
            {{ "#BBFF00" }}
            {% elif count <= -400  %}
            {{ "#CCFF00" }}
            {% elif count <= -300  %}
            {{ "#DDFF00" }}
            {% elif count <= -200  %}
            {{ "#EEFF00" }}
            {% elif count <= -100  %}
            {{ "#FFFF00" }}
            {% elif count <= -0  %}
            {{ "#FFFF00" }}
            {% elif count <= 100  %}
            {{ "#FFEE00" }}
            {% elif count <= 200  %}
            {{ "#FFDD00" }}
            {% elif count <= 300  %}
            {{ "#FFCC00" }}
            {% elif count <= 400  %}
            {{ "#FFBB00" }}
            {% elif count <= 500  %}
            {{ "#FFAA00" }}
            {% elif count <= 600  %}
            {{ "#FF9900" }}
            {% elif count <= 700  %}
            {{ "#FF8800" }}
            {% elif count <= 800  %}
            {{ "#FF7700" }}
            {% elif count <= 900  %}
            {{ "#FF6600" }}
            {% elif count <= 1000  %}
            {{ "#FF5500" }}
            {% elif count <= 1100  %}
            {{ "#FF4400" }}
            {% elif count <= 1200  %}
            {{ "#FF3300" }}
            {% elif count <= 1300  %}
            {{ "#FF2200" }}
            {% elif count <= 1400  %}
            {{ "#FF1100" }}
            {% else %}
            {{ "#FF0000" }}
            {% endif %}

      - obj: "p2b40" # Load Power Direction Line
        properties:
          "line_color": >
            {% set count = states('sensor.mp2_conso_out1_mqtt')|int %}
            {% if count <= 100  %}
            {{ "#00FF00" }}
            {% elif count <= 200  %}
            {{ "#11FF00" }}
            {% elif count <= 300  %}
            {{ "#22FF00" }}
            {% elif count <= 400  %}
            {{ "#33FF00" }}
            {% elif count <= 500  %}
            {{ "#44FF00" }}
            {% elif count <= 600  %}
            {{ "#55FF00" }}
            {% elif count <= 700  %}
            {{ "#66FF00" }}
            {% elif count <= 800  %}
            {{ "#77FF00" }}
            {% elif count <= 900  %}
            {{ "#88FF00" }}
            {% elif count <= 1000  %}
            {{ "#99FF00" }}
            {% elif count <= 1100  %}
            {{ "#AAFF00" }}
            {% elif count <= 1200  %}
            {{ "#BBFF00" }}
            {% elif count <= 1300  %}
            {{ "#CCFF00" }}
            {% elif count <= 1400  %}
            {{ "#DDFF00" }}
            {% elif count <= 1500  %}
            {{ "#EEFF00" }}
            {% elif count <= 1600  %}
            {{ "#FFFF00" }}
            {% elif count <= 1700  %}
            {{ "#FFFF00" }}
            {% elif count <= 1800  %}
            {{ "#FFEE00" }}
            {% elif count <= 1900  %}
            {{ "#FFDD00" }}
            {% elif count <= 2000  %}
            {{ "#FFCC00" }}
            {% elif count <= 2100  %}
            {{ "#FFBB00" }}
            {% elif count <= 2200  %}
            {{ "#FFAA00" }}
            {% elif count <= 2300  %}
            {{ "#FF9900" }}
            {% elif count <= 2400  %}
            {{ "#FF8800" }}
            {% elif count <= 2500  %}
            {{ "#FF7700" }}
            {% elif count <= 2600  %}
            {{ "#FF6600" }}
            {% elif count <= 2700  %}
            {{ "#FF5500" }}
            {% elif count <= 2800  %}
            {{ "#FF4400" }}
            {% elif count <= 2900  %}
            {{ "#FF3300" }}
            {% elif count <= 3000  %}
            {{ "#FF2200" }}
            {% elif count <= 3100  %}
            {{ "#FF1100" }}
            {% else %}
            {{ "#FF0000" }}
            {% endif %}

      - obj: "p2b37" # PV Power Direction Line
        properties:
          "line_color": >
            {% set count = states('sensor.mp2_prod_totale_mqtt')|int %}
            {% if count <= 100  %}
            {{ "#FF0000" }}
            {% elif count <= 200  %}
            {{ "#FF1100" }}
            {% elif count <= 300  %}
            {{ "#FF2200" }}
            {% elif count <= 400  %}
            {{ "#FF3300" }}
            {% elif count <= 500  %}
            {{ "#FF4400" }}
            {% elif count <= 600  %}
            {{ "#FF5500" }}
            {% elif count <= 700  %}
            {{ "#FF6600" }}
            {% elif count <= 800  %}
            {{ "#FF7700" }}
            {% elif count <= 900  %}
            {{ "#FF8800" }}
            {% elif count <= 1000  %}
            {{ "#FF9900" }}
            {% elif count <= 1100  %}
            {{ "#FFAA00" }}
            {% elif count <= 1200  %}
            {{ "#FFBB00" }}
            {% elif count <= 1300  %}
            {{ "#FFCC00" }}
            {% elif count <= 1400  %}
            {{ "#FFDD00" }}
            {% elif count <= 1500  %}
            {{ "#FFEE00" }}
            {% elif count <= 1600  %}
            {{ "#FFFF00" }}
            {% elif count <= 1700  %}
            {{ "#EEFF00" }}
            {% elif count <= 1800  %}
            {{ "#DDFF00" }}
            {% elif count <= 1900  %}
            {{ "#CCFF00" }}
            {% elif count <= 2000  %}
            {{ "#BBFF00" }}
            {% elif count <= 2100  %}
            {{ "#AAFF00" }}
            {% elif count <= 2200  %}
            {{ "#99FF00" }}
            {% elif count <= 2300  %}
            {{ "#88FF00" }}
            {% elif count <= 2400  %}
            {{ "#77FF00" }}
            {% elif count <= 2500  %}
            {{ "#66FF00" }}
            {% elif count <= 2600  %}
            {{ "#55FF00" }}
            {% elif count <= 2700  %}
            {{ "#44FF00" }}
            {% elif count <= 2800  %}
            {{ "#33FF00" }}
            {% elif count <= 2900  %}
            {{ "#22FF00" }}
            {% elif count <= 3000  %}
            {{ "#11FF00" }}
            {% elif count <= 3100  %}
            {{ "#00FF00" }}
            {% else %}
            {{ "#00FF00" }}
            {% endif %}
      ############### Page 2 Weather ###############

      - obj: "p2b16" # temperature label on all pages
        properties:
          "text": '{{ states("sensor.vp2_temp_out") }}°C'

      - obj: "p2b18" # Weather Icon change according to weather
        properties:
          "text": >
            {% set forecast = states('weather.albi') %}
            {% if forecast == "clear-night"  %}
            {{ "\uE594" }}
            {% elif forecast == "cloudy"   %}
            {{ "\uE590" }}
            {% elif forecast == "fog"   %}
            {{ "\uE591" }}
            {% elif forecast == "hail"   %}
            {{ "\uE592" }}
            {% elif forecast == "lightning"   %}
            {{ "\uE593" }}
            {% elif forecast == "lightning-rainy"   %}
            {{ "\uE67E" }}
            {% elif forecast == "partlycloudy"   %}
            {{ "\uE595" }}
            {% elif forecast == "pouring"   %}
            {{ "\uE596" }}
            {% elif forecast == "rainy"   %}
            {{ "\uE597" }}
            {% elif forecast == "snowy"   %}
            {{ "\uE598" }}
            {% elif forecast == "snowy-rainy"   %}
            {{ "\uE67F" }}
            {% elif forecast == "sunny"   %}
            {{ "\uE5A8" }}
            {% elif forecast == "windy"   %}
            {{ "\uE59D" }}
            {% elif forecast == "windy-variant"   %}
            {{ "\uE59E" }}
            {% elif forecast == "exceptional"   %}
            {{ "\uE59E" }}
            {% else   %}
            {{ "\uE5A8" }}
            {% endif %}

      - obj: "p2b15" # Day today
        properties:
          "text": '{{ (as_timestamp(now()))|timestamp_custom("%A") }}'

      - obj: "p2b61" # Day tomorrow
        properties:
          "text": '{{ (as_timestamp(now())+(60*60*24))|timestamp_custom("%A") }}'

      - obj: "p2b71" # Day today + 2
        properties:
          "text": '{{ (as_timestamp(now())+(60*60*24*2))|timestamp_custom("%A") }}'

      - obj: "p2b81" # Day today + 3
        properties:
          "text": '{{ (as_timestamp(now())+(60*60*24*3))|timestamp_custom("%A") }}'

      - obj: "p2b91" # Day today + 4
        properties:
          "text": '{{ (as_timestamp(now())+(60*60*24*4))|timestamp_custom("%A") }}'

      - obj: "p2b101" # Day today + 5
        properties:
          "text": '{{ (as_timestamp(now())+(60*60*24*5))|timestamp_custom("%A") }}'

      - obj: "p2b111" # Day today + 6
        properties:
          "text": '{{ (as_timestamp(now())+(60*60*24*6))|timestamp_custom("%A") }}'

      ############### Page 3 Lights ###############

      - obj: "p3b2" # Master Bedroom Light
        properties:
          "val": '{{ 1 if is_state("light.master_bedroom", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.master_bedroom"

      - obj: "p3b3" # Alice Bedroom Light
        properties:
          "val": '{{ 1 if is_state("light.main", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.main"

      - obj: "p3b4" # Landing Light
        properties:
          "val": '{{ 1 if is_state("light.landing_light", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.landing_light"

      - obj: "p3b5" # Bathroom
        properties:
          "val": '{{ 1 if is_state("light.bathroom", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.bathroom"

      - obj: "p3b6" # Master Bedroom AC
        properties:
          "val": '{{ 1 if is_state("switch.ac_socket_1", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "switch.ac_socket_1"

      - obj: "p3b7" # Toilet Light
        properties:
          "val": '{{ 1 if is_state("light.toilet_light", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.toilet_light"

      - obj: "p3b8" # Hallway Light
        properties:
          "val": '{{ 1 if is_state("light.hallway_light", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.hallway_light"

      - obj: "p3b9" # Kitchen Light
        properties:
          "val": '{{ 1 if is_state("light.kitchen_light", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.kitchen_light"

      - obj: "p3b10" # Dining Room Light
        properties:
          "val": '{{ 1 if is_state("light.dining_room", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.dining_room"

      - obj: "p3b11" # Living Room Light
        properties:
          "val": '{{ 1 if is_state("light.living_room", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.living_room"

      - obj: "p3b12" # Patio Light
        properties:
          "val": '{{ 1 if is_state("light.patio_light", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.patio_light"

      - obj: "p3b13" # Living Room Fire
        properties:
          "val": '{{ 1 if is_state("switch.living_room_stove", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "switch.living_room_stove"

      - obj: "p3b14" # Living Room Scent Light
        properties:
          "val": '{{ 1 if is_state("light.scent_light", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.scent_light"

      - obj: "p3b15" # Kitchen Cupboard Light
        properties:
          "val": '{{ 1 if is_state("light.kitchen_light_switch_kitchen_cupboard_light", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.kitchen_light_switch_kitchen_cupboard_light"

      - obj: "p3b16" # Living Room TV Back Light
        properties:
          "val": '{{ 1 if is_state("light.living_room_backlight", "on") else 0 }}'
        event:
          "up":
            - service: homeassistant.toggle
              entity_id: "light.living_room_backlight"